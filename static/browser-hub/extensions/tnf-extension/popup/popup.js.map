{"version":3,"file":"popup/popup.js","mappings":";;AAAA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB,4BAA4B;AAC7C,mBAAmB,4BAA4B;AAC/C,oBAAoB,4BAA4B;AAChD,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT,uCAAuC,MAAM;;AAE7C;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,KAAK;;AAEL;AACA;AACA,mCAAmC,sBAAsB;AACzD,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,UAAU;AACV;AACA,+DAA+D,mCAAmC;AAClG;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,YAAY;AACZ;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,2BAA2B,sDAAsD;;AAEjF;AACA;AACA;AACA;AACA;AACA,wCAAwC,wBAAwB;AAChE,uCAAuC,iBAAiB,6BAA6B;AACrF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6DAA6D,eAAe;AAC5E;AACA;AACA;AACA,wCAAwC,mBAAmB,2CAA2C;AACtG,wCAAwC,iBAAiB,yBAAyB;AAClF;AACA;AACA;AACA;AACA;AACA,2DAA2D,eAAe;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA,2CAA2C,mCAAmC;AAC9E;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,sBAAsB,mBAAmB;AACzC;AACA,WAAW;AACX;AACA;AACA;;AAEA;AACA,8CAA8C,oBAAoB;AAClE;AACA;AACA;AACA,iDAAiD,OAAO;AACxD;AACA,YAAY;AACZ;AACA;AACA;AACA;AACA,SAAS;AACT,QAAQ;AACR,6CAA6C,UAAU;AACvD;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA,8DAA8D,0BAA0B;AACxF;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA,sDAAsD,gBAAgB;AACtE;AACA,MAAM;AACN;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY;AACZ;AACA;AACA,SAAS;AACT,QAAQ;AACR;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,sDAAsD,kBAAkB;AACxE;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,QAAQ;AACR;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,sBAAsB,8CAA8C,EAAE,QAAQ;;AAE9E;AACA,sDAAsD,iBAAiB;;AAEvE;AACA,sDAAsD,SAAS,EAAE,QAAQ;;AAEzE;AACA;AACA,QAAQ;AACR,kCAAkC,8DAA8D;AAChG;AACA,MAAM;AACN,+BAA+B,UAAU;AACzC;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,wBAAwB;AAC3D;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP,MAAM;AACN,oCAAoC,UAAU;AAC9C;AACA;;AAEA;AACA;AACA;AACA,6CAA6C,mCAAmC;AAChF;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN,+BAA+B,UAAU;AACzC;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,0CAA0C;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP,MAAM;AACN,+BAA+B,UAAU;AACzC;AACA;;AAEA;AACA;AACA;AACA,mCAAmC,yCAAyC;AAC5E;AACA,sDAAsD,oBAAoB;AAC1E;AACA;AACA;AACA,0CAA0C,WAAW;AACrD;AACA;AACA;AACA,UAAU;AACV;AACA;AACA,OAAO;AACP,MAAM;AACN,+BAA+B,UAAU;AACzC;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,sCAAsC,sDAAsD;AAC5F;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,4DAA4D,YAAY;AACxE;AACA;AACA;AACA,8CAA8C,8CAA8C;AAC5F;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,mCAAmC,4BAA4B;AAC/D;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,+CAA+C,6BAA6B;AAC5E;AACA;AACA,OAAO;AACP,MAAM;AACN;AACA;AACA;;AAEA;AACA;AACA,mCAAmC,mBAAmB;AACtD;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,kCAAkC;;AAElC;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA,qCAAqC,oCAAoC;AACzE;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,iCAAiC,iBAAiB;AAClD;AACA;AACA;;AAEA;AACA,iCAAiC,oBAAoB;AACrD;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,YAAY,mBAAmB;;AAE/B;AACA;AACA;AACA,oCAAoC,iBAAiB;AACrD;;AAEA;AACA;AACA;AACA,0CAA0C,iBAAiB;AAC3D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;AACA;AACA,qCAAqC,KAAK;AAC1C,yDAAyD,KAAK;AAC9D;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,eAAe,8DAA8D;AAC7E;AACA;AACA;AACA,oFAAoF,YAAY;AAChG;AACA;AACA;AACA;AACA,iEAAiE;AACjE;AACA;AACA;AACA;AACA,wCAAwC,eAAe,oCAAoC,oBAAoB,iBAAiB;AAChI,uCAAuC,0BAA0B,kBAAkB;AACnF,yCAAyC,8BAA8B,iBAAiB;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA,+CAA+C,SAAS;AACxD,oCAAoC,kCAAkC;AACtE;AACA,oCAAoC,WAAW;AAC/C,wCAAwC,eAAe;AACvD;AACA,6CAA6C,aAAa;AAC1D;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,4CAA4C,SAAS;AACrD,4CAA4C,+BAA+B;AAC3E;AACA,4CAA4C,+BAA+B;AAC3E;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA,8CAA8C,WAAW;AACzD;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,6DAA6D,0BAA0B;AACvF;;AAEA;AACA;AACA,sCAAsC,WAAW;AACjD;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,CAAC","sources":["webpack://the-new-fuse-chrome-extension/./src/v6/popup/popup.js"],"sourcesContent":["/**\n * Fuse Connect v6 - Popup Logic\n */\n\nconst NATIVE_HOST_NAME = 'com.thenewfuse.native_host';\n\nclass FuseConnectPopup {\n  constructor() {\n    this.state = {\n      connectionStatus: 'disconnected',\n      agents: [],\n      platform: null,\n      messages: [],\n      services: {\n        relay: { running: false, port: 3000 },\n        backend: { running: false, port: 3000 },\n        frontend: { running: false, port: 3002 },\n      },\n      nativeHostAvailable: false,\n      settings: {\n        relayUrl: 'ws://localhost:3000/ws',\n        autoReconnect: true,\n        showPanel: true,\n        debugMode: false,\n        allowedSites: [],\n      },\n    };\n\n    this.init();\n  }\n\n  async init() {\n    // Setup tab navigation\n    this.setupTabs();\n\n    // Setup event handlers\n    this.setupEventHandlers();\n\n    // Load initial state from background\n    await this.loadState();\n\n    // Listen for updates\n    this.setupMessageListener();\n\n    // Load settings\n    await this.loadSettings();\n\n    // Check native host\n    await this.checkNativeHost();\n\n    // Check relay health and show helper if needed\n    await this.checkRelayAndUpdateHelper();\n\n    // Update UI\n    this.updateUI();\n  }\n\n  async checkRelayAndUpdateHelper() {\n    const helper = document.getElementById('quick-start-helper');\n    if (!helper) return;\n\n    try {\n      const response = await fetch('http://localhost:3000/health', {\n        method: 'GET',\n        signal: AbortSignal.timeout(2000),\n      });\n      const data = await response.json();\n      if (data.status === 'ok') {\n        helper.style.display = 'none';\n      } else {\n        helper.style.display = 'block';\n      }\n    } catch (e) {\n      // Relay not running, show helper\n      helper.style.display = 'block';\n    }\n  }\n\n  setupTabs() {\n    const tabs = document.querySelectorAll('.tab');\n\n    tabs.forEach((tab) => {\n      tab.addEventListener('click', () => {\n        const tabId = tab.dataset.tab;\n\n        // Update active tab\n        tabs.forEach((t) => t.classList.remove('active'));\n        tab.classList.add('active');\n\n        // Show tab content\n        document.querySelectorAll('.tab-content').forEach((content) => {\n          content.classList.remove('active');\n        });\n        document.getElementById(`tab-${tabId}`)?.classList.add('active');\n\n        // Refresh services when switching to services tab\n        if (tabId === 'services') {\n          this.refreshServiceStatus();\n        }\n      });\n    });\n  }\n\n  setupEventHandlers() {\n    // Connect button\n    document.getElementById('connect-btn')?.addEventListener('click', () => {\n      if (this.state.connectionStatus === 'connected') {\n        this.disconnect();\n      } else {\n        this.connect();\n      }\n    });\n\n    // Refresh agents\n    document.getElementById('refresh-agents')?.addEventListener('click', () => {\n      chrome.runtime.sendMessage({ type: 'REQUEST_SYNC' });\n    });\n\n    // Open Panel on current page\n    document.getElementById('open-panel-btn')?.addEventListener('click', () => {\n      this.openPanelOnPage();\n    });\n\n    // Refresh services\n    document.getElementById('refresh-services')?.addEventListener('click', () => {\n      this.refreshServiceStatus();\n    });\n\n    // Service control buttons\n    document.querySelectorAll('[data-action]').forEach((btn) => {\n      btn.addEventListener('click', (e) => {\n        const action = e.target.dataset.action;\n        const service = e.target.dataset.service;\n        if (action && service) {\n          this.controlService(action, service);\n        }\n      });\n    });\n\n    // Start all services\n    document.getElementById('start-all-services')?.addEventListener('click', () => {\n      this.controlService('start', 'all');\n    });\n\n    // Stop all services\n    document.getElementById('stop-all-services')?.addEventListener('click', () => {\n      this.controlService('stop', 'all');\n    });\n\n    // Save settings\n    document.getElementById('save-settings')?.addEventListener('click', () => {\n      this.saveSettings();\n    });\n\n    // Settings inputs\n    document.getElementById('relay-url')?.addEventListener('change', (e) => {\n      this.state.settings.relayUrl = e.target.value;\n    });\n\n    document.getElementById('auto-reconnect')?.addEventListener('change', (e) => {\n      this.state.settings.autoReconnect = e.target.checked;\n    });\n\n    document.getElementById('show-panel')?.addEventListener('change', (e) => {\n      this.state.settings.showPanel = e.target.checked;\n    });\n\n    document.getElementById('debug-mode')?.addEventListener('change', (e) => {\n      this.state.settings.debugMode = e.target.checked;\n    });\n\n    // Managed Sites\n    document.getElementById('add-site-btn')?.addEventListener('click', () => {\n      this.addManagedSite();\n    });\n\n    document.getElementById('new-site-input')?.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') this.addManagedSite();\n    });\n\n    document.getElementById('sites-list')?.addEventListener('click', (e) => {\n      if (e.target.classList.contains('delete-site-btn')) {\n        const site = e.target.dataset.site;\n        this.removeManagedSite(site);\n      }\n    });\n\n    // Export logs\n    document.getElementById('export-logs')?.addEventListener('click', () => {\n      this.exportLogs();\n    });\n\n    // Quick start relay button\n    document.getElementById('quick-start-relay')?.addEventListener('click', () => {\n      this.quickStartRelay();\n    });\n  }\n\n  async quickStartRelay() {\n    const btn = document.getElementById('quick-start-relay');\n    if (btn) {\n      btn.disabled = true;\n      btn.innerHTML = '‚è≥ Starting...';\n    }\n\n    if (this.state.nativeHostAvailable) {\n      // Use native host to open Terminal and run relay command\n      try {\n        const response = await this.sendNativeMessage({\n          action: 'open-terminal',\n          command: 'pnpm relay:start',\n        });\n\n        if (response.success) {\n          this.showToast('Terminal opened! Wait for relay to start...');\n          // Wait and try to connect\n          setTimeout(() => {\n            this.connect();\n            this.checkRelayAndUpdateHelper();\n          }, 5000);\n        } else {\n          // Fallback to background start\n          const startResponse = await this.sendNativeMessage({ action: 'start', service: 'relay' });\n          if (startResponse.result?.success) {\n            this.showToast('Relay started! Connecting...');\n            setTimeout(() => {\n              this.connect();\n              this.checkRelayAndUpdateHelper();\n            }, 3000);\n          } else {\n            this.showToast(startResponse.result?.error || 'Failed to start relay');\n          }\n        }\n      } catch (e) {\n        this.showToast('Error: ' + e.message);\n      }\n    } else {\n      // No native host - show installation helper\n      this.showInstallHelper();\n    }\n\n    if (btn) {\n      btn.disabled = false;\n      btn.innerHTML = 'üöÄ Start Relay Server';\n    }\n  }\n\n  showInstallHelper() {\n    // Create a modal/overlay with installation instructions\n    const extensionId = chrome.runtime.id;\n    const installPath = `${chrome.runtime.getURL('native-host/install-macos.sh')}`;\n\n    const modal = document.createElement('div');\n    modal.id = 'install-helper-modal';\n    modal.innerHTML = `\n      <div class=\"modal-overlay\">\n        <div class=\"modal-content\">\n          <h3 style=\"margin:0 0 12px 0; color: var(--neon-cyan);\">‚ö° Setup Required</h3>\n          <p style=\"margin:0 0 16px 0; font-size: 13px; color: var(--text-secondary);\">\n            To start services from the browser, install the native helper:\n          </p>\n          <div class=\"install-steps\">\n            <div class=\"install-step\">\n              <span class=\"step-num\">1</span>\n              <span>Open Terminal</span>\n            </div>\n            <div class=\"install-step\">\n              <span class=\"step-num\">2</span>\n              <span>Run this command:</span>\n            </div>\n            <code class=\"install-command\" id=\"install-command\">\n              cd ~/Desktop/A1-Inter-LLM-Com/The-New-Fuse/apps/chrome-extension && ./install.sh\n            </code>\n            <button class=\"btn-secondary\" style=\"width:100%; margin-top:8px;\" id=\"copy-install-cmd\">\n              üìã Copy Command\n            </button>\n          </div>\n          <div style=\"margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--border-subtle);\">\n            <p style=\"margin:0 0 8px 0; font-size: 12px; color: var(--text-muted);\">\n              Or start relay manually in terminal:\n            </p>\n            <code class=\"install-command\" id=\"manual-command\">\n              cd ~/Desktop/A1-Inter-LLM-Com/The-New-Fuse && pnpm relay:start\n            </code>\n            <button class=\"btn-primary\" style=\"width:100%; margin-top:8px;\" id=\"copy-manual-cmd\">\n              üìã Copy & Close\n            </button>\n          </div>\n          <button class=\"modal-close\" id=\"close-modal\">‚úï</button>\n        </div>\n      </div>\n    `;\n\n    // Add modal styles\n    const styles = `\n      .modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.8);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 10000;\n        padding: 20px;\n      }\n      .modal-content {\n        background: var(--bg-card);\n        border: 1px solid var(--border-accent);\n        border-radius: var(--radius-lg);\n        padding: 20px;\n        max-width: 340px;\n        position: relative;\n        box-shadow: 0 0 40px rgba(0, 217, 255, 0.2);\n      }\n      .modal-close {\n        position: absolute;\n        top: 10px;\n        right: 10px;\n        background: none;\n        border: none;\n        color: var(--text-muted);\n        cursor: pointer;\n        font-size: 16px;\n      }\n      .modal-close:hover {\n        color: var(--neon-red);\n      }\n      .install-steps {\n        background: var(--bg-elevated);\n        border-radius: var(--radius-md);\n        padding: 12px;\n      }\n      .install-step {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        margin-bottom: 8px;\n        font-size: 13px;\n        color: var(--text-primary);\n      }\n      .step-num {\n        width: 22px;\n        height: 22px;\n        background: var(--neon-cyan);\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        font-size: 11px;\n        font-weight: 600;\n        color: #000;\n      }\n      .install-command {\n        display: block;\n        background: var(--bg-deep);\n        padding: 10px;\n        border-radius: var(--radius-sm);\n        font-family: 'Monaco', 'Consolas', monospace;\n        font-size: 10px;\n        color: var(--neon-green);\n        word-break: break-all;\n        user-select: all;\n        cursor: text;\n        margin-top: 8px;\n      }\n    `;\n\n    const styleEl = document.createElement('style');\n    styleEl.textContent = styles;\n    document.head.appendChild(styleEl);\n    document.body.appendChild(modal);\n\n    // Event handlers\n    document.getElementById('copy-install-cmd')?.addEventListener('click', () => {\n      navigator.clipboard.writeText(\n        'cd ~/Desktop/A1-Inter-LLM-Com/The-New-Fuse/apps/chrome-extension && ./install.sh'\n      );\n      this.showToast('Command copied!');\n    });\n\n    document.getElementById('copy-manual-cmd')?.addEventListener('click', () => {\n      navigator.clipboard.writeText(\n        'cd ~/Desktop/A1-Inter-LLM-Com/The-New-Fuse && pnpm relay:start'\n      );\n      this.showToast('Command copied!');\n      modal.remove();\n      styleEl.remove();\n    });\n\n    document.getElementById('close-modal')?.addEventListener('click', () => {\n      modal.remove();\n      styleEl.remove();\n    });\n  }\n\n  async openPanelOnPage() {\n    // Get the active tab\n    const tabs = await chrome.tabs.query({ active: true, currentWindow: true });\n    if (tabs[0]?.id) {\n      try {\n        // Did we inject?\n        const isScriptInjected = await this.checkContentScript(tabs[0].id);\n\n        if (!isScriptInjected) {\n          this.showToast('Injecting content script...');\n          await chrome.scripting.executeScript({\n            target: { tabId: tabs[0].id },\n            files: ['content/index.js'],\n          });\n          // Brief wait for initialization\n          await new Promise((r) => setTimeout(r, 500));\n        }\n\n        // Send message to content script to show panel\n        chrome.tabs.sendMessage(tabs[0].id, { type: 'SHOW_PANEL' }, (response) => {\n          if (chrome.runtime.lastError) {\n            const err = chrome.runtime.lastError;\n            const errMsg = err.message || JSON.stringify(err);\n            this.showToast(`Cannot open panel: ${errMsg}`);\n            console.error('Fuse Panel Open Error:', errMsg, err);\n          } else if (response?.success) {\n            this.showToast('Panel opened! (Ctrl+Shift+F to toggle)');\n            // Close popup after opening panel\n            window.close();\n          }\n        });\n      } catch (e) {\n        this.showToast(`Cannot open panel: ${e.message}`);\n        console.error('Fuse Panel Exception:', e);\n      }\n    } else {\n      this.showToast('No active tab found');\n    }\n  }\n\n  async checkContentScript(tabId) {\n    try {\n      const response = await chrome.tabs.sendMessage(tabId, { type: 'GET_PANEL_STATUS' });\n      return !!response;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  async checkNativeHost() {\n    try {\n      const response = await this.sendNativeMessage({ action: 'ping' });\n      this.state.nativeHostAvailable = response.action === 'pong';\n    } catch (e) {\n      this.state.nativeHostAvailable = false;\n    }\n    this.updateNativeHostIndicator();\n  }\n\n  async sendNativeMessage(message) {\n    return new Promise((resolve, reject) => {\n      try {\n        chrome.runtime.sendNativeMessage(NATIVE_HOST_NAME, message, (response) => {\n          if (chrome.runtime.lastError) {\n            reject(new Error(chrome.runtime.lastError.message));\n          } else {\n            resolve(response);\n          }\n        });\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n\n  async refreshServiceStatus() {\n    if (!this.state.nativeHostAvailable) {\n      // Try to check again\n      await this.checkNativeHost();\n      if (!this.state.nativeHostAvailable) {\n        return;\n      }\n    }\n\n    try {\n      const response = await this.sendNativeMessage({ action: 'status' });\n      if (response.services) {\n        this.state.services = response.services;\n        this.updateServiceUI();\n      }\n    } catch (e) {\n      console.error('Failed to get service status:', e);\n    }\n  }\n\n  async controlService(action, service) {\n    // Handle AI Studio specific actions\n    if (service === 'ai-studio') {\n      if (action === 'auth') {\n        this.handleAIStudioAuth();\n        return;\n      } else if (action === 'process') {\n        this.handleAIStudioProcess();\n        return;\n      } else if (action === 'history') {\n        this.handleAIStudioHistory();\n        return;\n      } else if (action === 'export') {\n        this.handleAIStudioExport();\n        return;\n      }\n    }\n\n    if (!this.state.nativeHostAvailable) {\n      this.showToast('Native host not available. Run the install script.');\n      return;\n    }\n\n    this.showToast(`${action === 'start' ? 'Starting' : 'Stopping'} ${service}...`);\n\n    try {\n      const response = await this.sendNativeMessage({ action, service });\n\n      if (response.result?.success || response.results) {\n        this.showToast(response.result?.message || `${service} ${action} completed`);\n\n        // Refresh status after action\n        setTimeout(() => this.refreshServiceStatus(), 2000);\n      } else {\n        this.showToast(`Failed: ${response.result?.error || response.message || 'Unknown error'}`);\n      }\n    } catch (e) {\n      this.showToast(`Error: ${e.message}`);\n    }\n  }\n\n  async handleAIStudioAuth() {\n    this.showToast('Opening Google OAuth...');\n    try {\n      chrome.runtime.sendMessage({ type: 'AI_STUDIO_AUTH' }, (response) => {\n        if (response?.success) {\n          this.showToast('Authenticated successfully!');\n          this.updateAIStudioStatus('connected');\n        } else {\n          this.showToast('Authentication failed');\n        }\n      });\n    } catch (e) {\n      this.showToast(`Auth error: ${e.message}`);\n    }\n  }\n\n  async handleAIStudioProcess() {\n    this.showToast('Opening AI Studio panel...');\n    try {\n      const tabs = await chrome.tabs.query({ active: true, currentWindow: true });\n      if (tabs[0]?.id) {\n        chrome.tabs.sendMessage(\n          tabs[0].id,\n          {\n            type: 'SHOW_PANEL',\n            activeTab: 'services',\n          },\n          (response) => {\n            if (response?.success) {\n              this.showToast('Panel opened! Check the Services tab.');\n              window.close();\n            }\n          }\n        );\n      }\n    } catch (e) {\n      this.showToast(`Error: ${e.message}`);\n    }\n  }\n\n  async handleAIStudioHistory() {\n    this.showToast('Generating watch history prompt...');\n    try {\n      chrome.runtime.sendMessage({ type: 'AI_VIDEO_GENERATE_HISTORY_PROMPT' }, (response) => {\n        if (response?.prompt) {\n          // Show prompt in a way user can copy it\n          const textArea = document.createElement('textarea');\n          textArea.value = response.prompt;\n          document.body.appendChild(textArea);\n          textArea.select();\n          document.execCommand('copy');\n          document.body.removeChild(textArea);\n          this.showToast('Prompt copied to clipboard! Paste it into Gemini.');\n\n          // Open Gemini\n          window.open('https://gemini.google.com/', '_blank');\n        } else {\n          this.showToast('Failed to generate prompt');\n        }\n      });\n    } catch (e) {\n      this.showToast(`Error: ${e.message}`);\n    }\n  }\n\n  async handleAIStudioExport() {\n    this.showToast('Preparing export...');\n    try {\n      chrome.runtime.sendMessage({ type: 'AI_VIDEO_EXPORT', format: 'urls' }, (response) => {\n        if (response?.content) {\n          const blob = new Blob([response.content], { type: 'text/plain' });\n          const url = URL.createObjectURL(blob);\n          const a = document.createElement('a');\n          a.href = url;\n          a.download = `notebooklm-urls-${Date.now()}.txt`;\n          a.click();\n          URL.revokeObjectURL(url);\n          this.showToast('Export complete!');\n        } else {\n          this.showToast('Export failed');\n        }\n      });\n    } catch (e) {\n      this.showToast(`Error: ${e.message}`);\n    }\n  }\n\n  updateAIStudioStatus(status) {\n    const statusEl = document.getElementById('service-ai-studio-status');\n    if (statusEl) {\n      const dot = statusEl.querySelector('.status-dot');\n      if (dot) {\n        dot.className = `status-dot ${status === 'connected' ? 'connected' : 'disconnected'}`;\n      }\n    }\n  }\n\n  updateNativeHostIndicator() {\n    const indicator = document.getElementById('native-host-indicator');\n    if (indicator) {\n      if (this.state.nativeHostAvailable) {\n        indicator.textContent = 'üü¢ Connected';\n        indicator.style.color = '#00ff88';\n      } else {\n        indicator.textContent = 'üî¥ Not Installed';\n        indicator.style.color = '#ff3366';\n      }\n    }\n  }\n\n  updateServiceUI() {\n    for (const [serviceName, status] of Object.entries(this.state.services)) {\n      const card = document.querySelector(`[data-service=\"${serviceName}\"]`);\n      if (card) {\n        const statusDot = card.querySelector('.status-dot');\n        if (statusDot) {\n          statusDot.className = `status-dot ${status.running ? 'connected' : 'disconnected'}`;\n        }\n\n        // Update card class\n        if (status.running) {\n          card.classList.add('running');\n        } else {\n          card.classList.remove('running');\n        }\n\n        // Update buttons\n        const startBtn = card.querySelector('[data-action=\"start\"]');\n        const stopBtn = card.querySelector('[data-action=\"stop\"]');\n        if (startBtn) startBtn.disabled = status.running;\n        if (stopBtn) stopBtn.disabled = !status.running;\n      }\n    }\n\n    // Refresh AI Video Stats if visible\n    this.refreshAIVideoStats();\n  }\n\n  async refreshAIVideoStats() {\n    try {\n      chrome.runtime.sendMessage({ type: 'AI_VIDEO_GET_STATS' }, (stats) => {\n        if (stats) {\n          const processedEl = document.getElementById('ai-video-processed');\n          const totalEl = document.getElementById('ai-video-total');\n          const costEl = document.getElementById('ai-video-cost');\n          const accountEl = document.getElementById('ai-video-account');\n\n          if (processedEl) processedEl.textContent = stats.processed || '0';\n          if (totalEl) totalEl.textContent = stats.total || '0';\n          if (costEl) costEl.textContent = `$${(stats.cost || 0).toFixed(2)}`;\n          if (accountEl) accountEl.textContent = stats.account || 'None';\n        }\n      });\n    } catch (e) {\n      console.warn('Failed to refresh AI Video stats:', e);\n    }\n  }\n\n  async loadState() {\n    return new Promise((resolve) => {\n      chrome.runtime.sendMessage({ type: 'GET_STATE' }, (response) => {\n        if (response) {\n          this.state.connectionStatus = response.connectionStatus || 'disconnected';\n          this.state.agents = response.agents || [];\n        }\n        resolve();\n      });\n    });\n  }\n\n  async loadSettings() {\n    return new Promise((resolve) => {\n      chrome.storage.local.get(['fuse_settings'], (result) => {\n        if (result.fuse_settings) {\n          this.state.settings = { ...this.state.settings, ...result.fuse_settings };\n\n          // Update UI\n          const relayUrl = document.getElementById('relay-url');\n          if (relayUrl) relayUrl.value = this.state.settings.relayUrl;\n\n          const autoReconnect = document.getElementById('auto-reconnect');\n          if (autoReconnect) autoReconnect.checked = this.state.settings.autoReconnect;\n\n          const showPanel = document.getElementById('show-panel');\n          if (showPanel) showPanel.checked = this.state.settings.showPanel;\n\n          const debugMode = document.getElementById('debug-mode');\n          if (debugMode) debugMode.checked = this.state.settings.debugMode;\n\n          this.updateManagedSitesList();\n        }\n        resolve();\n      });\n    });\n  }\n\n  async saveSettings() {\n    await chrome.storage.local.set({ fuse_settings: this.state.settings });\n    this.showToast('Settings saved!');\n  }\n\n  setupMessageListener() {\n    chrome.runtime.onMessage.addListener((message) => {\n      switch (message.type) {\n        case 'CONNECTION_STATUS':\n          this.state.connectionStatus = message.status;\n          this.updateUI();\n          break;\n\n        case 'AGENTS_UPDATE':\n          this.state.agents = message.agents;\n          this.updateAgentsList();\n          this.updateStats();\n          break;\n\n        case 'NEW_MESSAGE':\n          this.state.messages.unshift(message.message);\n          if (this.state.messages.length > 20) {\n            this.state.messages = this.state.messages.slice(0, 20);\n          }\n          this.updateMessageList();\n          break;\n      }\n    });\n  }\n\n  connect() {\n    chrome.runtime.sendMessage({ type: 'CONNECT' });\n    this.state.connectionStatus = 'connecting';\n    this.updateUI();\n  }\n\n  disconnect() {\n    chrome.runtime.sendMessage({ type: 'DISCONNECT' });\n    this.state.connectionStatus = 'disconnected';\n    this.updateUI();\n  }\n\n  updateUI() {\n    this.updateConnectionStatus();\n    this.updateAgentsList();\n    this.updateStats();\n    this.updateServiceUI();\n    this.updateNativeHostIndicator();\n    this.updateQuickStartHelper();\n  }\n\n  updateQuickStartHelper() {\n    const helper = document.getElementById('quick-start-helper');\n    if (!helper) return;\n\n    // Hide helper if connected\n    if (this.state.connectionStatus === 'connected') {\n      helper.style.display = 'none';\n    }\n  }\n\n  updateConnectionStatus() {\n    const { connectionStatus } = this.state;\n\n    // Update indicator dot\n    const dot = document.querySelector('.status-dot');\n    if (dot) {\n      dot.className = `status-dot ${connectionStatus}`;\n    }\n\n    // Update connection icon\n    const icon = document.getElementById('connection-icon');\n    if (icon) {\n      icon.className = `connection-icon ${connectionStatus}`;\n    }\n\n    // Update status text\n    const statusText = document.getElementById('connection-status-text');\n    if (statusText) {\n      const texts = {\n        connected: 'Connected',\n        connecting: 'Connecting...',\n        disconnected: 'Disconnected',\n        reconnecting: 'Reconnecting...',\n        error: 'Connection Error',\n      };\n      statusText.textContent = texts[connectionStatus] || 'Unknown';\n    }\n\n    // Update button\n    const btn = document.getElementById('connect-btn');\n    if (btn) {\n      if (connectionStatus === 'connected') {\n        btn.innerHTML = '<span class=\"btn-icon\">üîå</span> Disconnect';\n        btn.classList.add('disconnect');\n      } else if (connectionStatus === 'connecting' || connectionStatus === 'reconnecting') {\n        btn.innerHTML = '<span class=\"btn-icon\">‚è≥</span> Connecting...';\n        btn.disabled = true;\n      } else {\n        btn.innerHTML = '<span class=\"btn-icon\">üîå</span> Connect to Relay';\n        btn.classList.remove('disconnect');\n        btn.disabled = false;\n      }\n    }\n  }\n\n  updateManagedSitesList() {\n    const list = document.getElementById('sites-list');\n    const sites = this.state.settings.allowedSites || [];\n\n    if (list) {\n      if (sites.length === 0) {\n        list.innerHTML = '<div class=\"empty-sites\">No custom sites added</div>';\n      } else {\n        list.innerHTML = sites\n          .map(\n            (site) => `\n          <div class=\"site-item\">\n            <span class=\"site-url\">${site}</span>\n            <button class=\"delete-site-btn\" data-site=\"${site}\" title=\"Remove\">‚úï</button>\n          </div>\n        `\n          )\n          .join('');\n      }\n    }\n  }\n\n  addManagedSite() {\n    const input = document.getElementById('new-site-input');\n    if (!input) return;\n\n    const rawSite = input.value.trim().toLowerCase();\n    if (!rawSite) return;\n\n    // Basic clean up: remove http://, https://, www.\n    let site = rawSite.replace(/^https?:\\/\\//, '').replace(/^www\\./, '');\n\n    // Remove path, keep only hostname\n    site = site.split('/')[0];\n\n    if (!site) return;\n\n    if (!this.state.settings.allowedSites) {\n      this.state.settings.allowedSites = [];\n    }\n\n    if (!this.state.settings.allowedSites.includes(site)) {\n      this.state.settings.allowedSites.push(site);\n      this.saveSettings();\n      this.updateManagedSitesList();\n      input.value = '';\n    } else {\n      this.showToast('Site already added');\n    }\n  }\n\n  removeManagedSite(site) {\n    if (!this.state.settings.allowedSites) return;\n\n    this.state.settings.allowedSites = this.state.settings.allowedSites.filter((s) => s !== site);\n    this.saveSettings();\n    this.updateManagedSitesList();\n  }\n\n  updateAgentsList() {\n    const container = document.getElementById('agents-list');\n    if (!container) return;\n\n    if (this.state.agents.length === 0) {\n      const isConnected = this.state.connectionStatus === 'connected';\n      container.innerHTML = `\n        <div class=\"empty-state\">\n          <span class=\"empty-icon\">ü§ñ</span>\n          <p>${isConnected ? 'Waiting for agents...' : 'No agents connected'}</p>\n          ${\n            !isConnected\n              ? `\n            <button class=\"btn-secondary\" id=\"go-to-connect\" style=\"margin: 12px 0; width: 100%;\">\n              üîå Connect to Relay First\n            </button>\n          `\n              : `\n            <p class=\"empty-hint\" style=\"color: var(--neon-cyan);\">\n              Relay connected! Agents will appear here when they join.\n            </p>\n          `\n          }\n          <div style=\"margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.03); border-radius: 8px; text-align: left;\">\n            <p style=\"font-size: 11px; color: var(--text-muted); margin: 0 0 8px 0;\">Available agent types:</p>\n            <div style=\"font-size: 12px; color: var(--text-secondary); line-height: 1.6;\">\n              üî∑ VS Code Extension<br>\n              üñ•Ô∏è Electron Desktop<br>\n              üåê Browser Extensions<br>\n              üöÄ API Gateway\n            </div>\n          </div>\n        </div>\n      `;\n\n      // Add click handler for connect button\n      document.getElementById('go-to-connect')?.addEventListener('click', () => {\n        // Switch to Connect tab\n        document.querySelector('[data-tab=\"connect\"]')?.click();\n      });\n      return;\n    }\n\n    container.innerHTML = this.state.agents\n      .map(\n        (agent) => `\n      <div class=\"agent-card\" data-agent-id=\"${agent.id}\">\n        <div class=\"agent-avatar\">${this.getAgentIcon(agent.platform)}</div>\n        <div class=\"agent-info\">\n          <div class=\"agent-name\">${agent.name}</div>\n          <div class=\"agent-platform\">${agent.platform}</div>\n        </div>\n        <div class=\"agent-status-indicator ${agent.status}\"></div>\n      </div>\n    `\n      )\n      .join('');\n\n    // Add click handlers for direct message\n    container.querySelectorAll('.agent-card').forEach((card) => {\n      card.addEventListener('click', () => {\n        const agentId = card.dataset.agentId;\n        this.showDirectMessagePrompt(agentId);\n      });\n    });\n  }\n\n  updateStats() {\n    const agentsEl = document.getElementById('stat-agents');\n    if (agentsEl) agentsEl.textContent = this.state.agents.length.toString();\n\n    const messagesEl = document.getElementById('stat-messages');\n    if (messagesEl) messagesEl.textContent = this.state.messages.length.toString();\n  }\n\n  updateMessageList() {\n    const container = document.getElementById('message-list');\n    if (!container) return;\n\n    if (this.state.messages.length === 0) {\n      container.innerHTML = `\n        <div class=\"empty-state small\">\n          <p>No recent messages</p>\n        </div>\n      `;\n      return;\n    }\n\n    container.innerHTML = this.state.messages\n      .slice(0, 10)\n      .map(\n        (msg) => `\n      <div class=\"message-item\">\n        <div class=\"message-item-header\">\n          <span class=\"message-item-from\">${msg.from}</span>\n          <span class=\"message-item-time\">${this.formatTime(msg.timestamp)}</span>\n        </div>\n        <div class=\"message-item-content\">${this.truncate(msg.content, 80)}</div>\n      </div>\n    `\n      )\n      .join('');\n  }\n\n  showDirectMessagePrompt(agentId) {\n    const agent = this.state.agents.find((a) => a.id === agentId);\n    if (!agent) return;\n\n    const message = prompt(`Send message to ${agent.name}:`);\n    if (message) {\n      chrome.runtime.sendMessage({\n        type: 'SEND_TO_AGENT',\n        agentId,\n        content: message,\n      });\n    }\n  }\n\n  async exportLogs() {\n    // Get logs from storage\n    const result = await chrome.storage.local.get(['fuse_logs']);\n    const logs = result.fuse_logs || [];\n\n    // Create download\n    const blob = new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `fuse-connect-logs-${Date.now()}.json`;\n    a.click();\n\n    URL.revokeObjectURL(url);\n    this.showToast('Logs exported!');\n  }\n\n  showToast(message) {\n    // Simple toast notification\n    const toast = document.createElement('div');\n    toast.style.cssText = `\n      position: fixed;\n      bottom: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      padding: 8px 16px;\n      background: linear-gradient(135deg, #00D9FF, #9D4EDD);\n      color: white;\n      border-radius: 8px;\n      font-size: 12px;\n      font-weight: 500;\n      z-index: 10000;\n      animation: fadeInUp 0.3s ease;\n    `;\n    toast.textContent = message;\n    document.body.appendChild(toast);\n\n    setTimeout(() => {\n      toast.style.animation = 'fadeOut 0.3s ease';\n      setTimeout(() => toast.remove(), 300);\n    }, 2000);\n  }\n\n  getAgentIcon(platform) {\n    const icons = {\n      'chrome-extension': 'üåê',\n      vscode: 'üî∑',\n      antigravity: 'üåå',\n      claude: 'ü§ñ',\n      chatgpt: 'üí¨',\n      gemini: '‚ú®',\n      'electron-desktop': 'üñ•Ô∏è',\n      'api-gateway': 'üöÄ',\n      'backend-service': '‚öôÔ∏è',\n    };\n    return icons[platform] || 'ü§ñ';\n  }\n\n  formatTime(timestamp) {\n    return new Date(timestamp).toLocaleTimeString([], {\n      hour: '2-digit',\n      minute: '2-digit',\n    });\n  }\n\n  truncate(text, length) {\n    return text.length > length ? text.substring(0, length) + '...' : text;\n  }\n}\n\n// Initialize\ndocument.addEventListener('DOMContentLoaded', () => {\n  new FuseConnectPopup();\n});\n"],"names":[],"ignoreList":[],"sourceRoot":""}