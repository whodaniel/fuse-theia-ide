import{a as t,t as e,b as n,c as o,g as s,N as r,d as i,e as a,f as c,h as u,n as d,j as l,R as f,A as p,s as m,C as h,k as g,P as y,S as v,l as w,o as S,p as x,q as E,r as b,v as N,w as T,x as I,y as C,z as R,B as D,D as _,E as L,F as M,G as O,H as z,I as A,J as k,K as P,L as V,M as H,O as F,Q as $,T as B,U as G,V as U,W,Y,Z as X,_ as j,$ as q}from"./datadog-BkLmkJ5p.js";import"./permissions-BsMI2TUG.js";import"./Main-DIS361Sg.js";const J=2,K=3,Z=4,Q=6,tt=7,et=8,nt=9,ot=0,st=1,rt=2,it=3,at=4,ct=11,ut=0,dt=1,lt=2,ft=3,pt=4,mt=5,ht=6,gt=7,yt=8,vt=5,wt=6,St=0,xt=1;function Et(t){return Boolean(t.changedTouches)}function bt(e){return!0===e.composed&&t(e.target)?e.composedPath()[0]:e.target}const Nt=(t,e)=>{const n=window.visualViewport,o={layoutViewportX:t,layoutViewportY:e,visualViewportX:t,visualViewportY:e};return n?(!function(t){return Math.abs(t.pageTop-t.offsetTop-window.scrollY)>25||Math.abs(t.pageLeft-t.offsetLeft-window.scrollX)>25}(n)?(o.visualViewportX=Math.round(t-n.offsetLeft),o.visualViewportY=Math.round(e-n.offsetTop)):(o.layoutViewportX=Math.round(t+n.offsetLeft),o.layoutViewportY=Math.round(e+n.offsetTop)),o):o},Tt=t=>({scale:t.scale,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,pageLeft:t.pageLeft,pageTop:t.pageTop,height:t.height,width:t.width});function It(t,n){return{data:{source:t,...n},type:K,timestamp:e()}}function Ct(t,e,s){const{throttled:r,cancel:i}=n(t=>{const n=bt(t),o=e.nodeIds.get(n);if(void 0===o)return;const r=Rt(t);if(!r)return;const i={id:o,timeOffset:0,x:r.x,y:r.y};s(It(Et(t)?ht:dt,{positions:[i]}))},50,{trailing:!1}),{stop:a}=o(t,document,["mousemove","touchmove"],r,{capture:!0,passive:!0});return{stop:()=>{a(),i()}}}function Rt(t){let{clientX:e,clientY:n}=Et(t)?t.changedTouches[0]:t;if(window.visualViewport){const{visualViewportX:t,visualViewportY:o}=Nt(e,n);e=t,n=o}if(Number.isFinite(e)&&Number.isFinite(n))return{x:e,y:n}}const Dt={pointerup:0,mousedown:1,click:2,contextmenu:3,dblclick:4,focus:vt,blur:wt,touchstart:7,touchend:9};function _t(t,e,n,i){return o(t,document,Object.keys(Dt),o=>{const a=bt(o),c=e.nodeIds.get(a);if(void 0===c||s(a,t.defaultPrivacyLevel)===r.HIDDEN)return;const u=Dt[o.type];let d;if(u!==wt&&u!==vt){const t=Rt(o);if(!t)return;d={id:c,type:u,x:t.x,y:t.y}}else d={id:c,type:u};const l={id:i.getIdForEvent(o),...It(lt,d)};n(l)},{capture:!0,passive:!0})}function Lt(t,e,o,u,d=document){const{throttled:l,cancel:f}=n(n=>{const c=bt(n);if(!c)return;const d=e.nodeIds.get(c);if(void 0===d||s(c,t.defaultPrivacyLevel)===r.HIDDEN)return;const l=c===document?{scrollTop:i(),scrollLeft:a()}:{scrollTop:Math.round(c.scrollTop),scrollLeft:Math.round(c.scrollLeft)};u.set(c,l),o(It(ft,{id:d,x:l.scrollLeft,y:l.scrollTop}))},100),{stop:p}=c(t,d,"scroll",l,{capture:!0,passive:!0});return{stop:()=>{p(),f()}}}function Mt(t,e){const n=u(t).subscribe(t=>{e(It(pt,t))});return{stop:()=>{n.unsubscribe()}}}function Ot(t,s){const r=window.visualViewport;if(!r)return{stop:d};const{throttled:i,cancel:a}=n(()=>{s({data:Tt(r),type:et,timestamp:e()})},200,{trailing:!1}),{stop:c}=o(t,r,["resize","scroll"],i,{capture:!0,passive:!0});return{stop:()=>{c(),a()}}}function zt(t,e,n){return o(t,document,["play","pause"],o=>{const i=bt(o);if(!i)return;const a=e.nodeIds.get(i);void 0!==a&&s(i,t.defaultPrivacyLevel)!==r.HIDDEN&&n(It(gt,{id:a,type:"play"===o.type?St:xt}))},{capture:!0,passive:!0})}function At(t,e){function n(e,n){if(!e||!e.ownerNode)return;const o=t.nodeIds.get(e.ownerNode);void 0!==o&&n(o)}const o=[l(CSSStyleSheet.prototype,"insertRule",({target:t,parameters:[o,s]})=>{n(t,t=>e(It(yt,{id:t,adds:[{rule:o,index:s}]})))}),l(CSSStyleSheet.prototype,"deleteRule",({target:t,parameters:[o]})=>{n(t,t=>e(It(yt,{id:t,removes:[{index:o}]})))})];function s(t){o.push(l(t.prototype,"insertRule",({target:t,parameters:[o,s]})=>{n(t.parentStyleSheet,n=>{const r=kt(t);r&&(r.push(s||0),e(It(yt,{id:n,adds:[{rule:o,index:r}]})))})}),l(t.prototype,"deleteRule",({target:t,parameters:[o]})=>{n(t.parentStyleSheet,n=>{const s=kt(t);s&&(s.push(o),e(It(yt,{id:n,removes:[{index:s}]})))})}))}return"undefined"!=typeof CSSGroupingRule?s(CSSGroupingRule):(s(CSSMediaRule),s(CSSSupportsRule)),{stop:()=>{o.forEach(t=>t.stop())}}}function kt(t){const e=[];let n=t;for(;n.parentRule;){const t=Array.from(n.parentRule.cssRules).indexOf(n);e.unshift(t),n=n.parentRule}if(!n.parentStyleSheet)return;const o=Array.from(n.parentStyleSheet.cssRules).indexOf(n);return e.unshift(o),e}function Pt(t,n){return o(t,window,["focus","blur"],()=>{n({data:{has_focus:document.hasFocus()},type:Q,timestamp:e()})})}function Vt(t,e,n){const o=t.subscribe(12,t=>{var o,s;t.rawRumEvent.type===f.ACTION&&t.rawRumEvent.action.type===p.CLICK&&(null===(s=null===(o=t.rawRumEvent.action.frustration)||void 0===o?void 0:o.type)||void 0===s?void 0:s.length)&&"events"in t.domainContext&&t.domainContext.events&&t.domainContext.events.length&&e({timestamp:t.rawRumEvent.date,type:nt,data:{frustrationTypes:t.rawRumEvent.action.frustration.type,recordIds:t.domainContext.events.map(t=>n.getIdForEvent(t))}})});return{stop:()=>{o.unsubscribe()}}}function Ht(t,n){const o=t.subscribe(5,()=>{n({timestamp:e(),type:tt})});return{stop:()=>{o.unsubscribe()}}}function Ft(t,e){const n=t.tagName,o=t.value;if(m(t,e)){const e=t.type;if("INPUT"===n&&("button"===e||"submit"===e||"reset"===e))return o;if(!o||"OPTION"===n)return;return h}return"OPTION"===n||"SELECT"===n?t.value:"INPUT"===n||"TEXTAREA"===n?o:void 0}const $t=/url\((?:(')([^']*)'|(")([^"]*)"|([^)]*))\)/gm,Bt=/^[A-Za-z]+:|^\/\//,Gt=/^["']?data:.*,/i;function Ut(t,e){return t.replace($t,(t,n,o,s,r,i)=>{const a=o||r||i;if(!e||!a||Bt.test(a)||Gt.test(a))return t;const c=n||s||"";return`url(${c}${function(t,e){try{return g(t,e).href}catch(n){return t}}(a,e)}${c})`})}const Wt=/[^a-z1-6-_]/;function Yt(t){const e=t.toLowerCase().trim();return Wt.test(e)?"div":e}function Xt(t,e){return`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${t}' height='${e}' style='background-color:silver'%3E%3C/svg%3E`}function jt(t){if(void 0!==t&&0!==t.length)return t.map(t=>{const e=t.cssRules||t.rules;return{cssRules:Array.from(e,t=>t.cssText),disabled:t.disabled||void 0,media:t.media.length>0?Array.from(t.media):void 0}})}function qt(t,e,n,o){if(e===r.HIDDEN)return null;const s=t.getAttribute(n);if(e===r.MASK&&n!==y&&!v.includes(n)&&n!==o.actionNameAttribute){const e=t.tagName;switch(n){case"title":case"alt":case"placeholder":return h}if("IMG"===e&&("src"===n||"srcset"===n)){const e=t;if(e.naturalWidth>0)return Xt(e.naturalWidth,e.naturalHeight);const{width:n,height:o}=t.getBoundingClientRect();return n>0||o>0?Xt(n,o):w}if("SOURCE"===e&&("src"===n||"srcset"===n))return w;if("A"===e&&"href"===n)return h;if(s&&n.startsWith("data-"))return h;if("IFRAME"===e&&"srcdoc"===n)return h}return s&&"string"==typeof s?S(s,1e6):s}function Jt(t,e,n){t[e].count+=1,t[e].max=Math.max(t[e].max,n),t[e].sum+=n}function Kt(t){if(!t)return null;let e;try{e=t.rules||t.cssRules}catch(n){}if(!e)return null;return Ut(Array.from(e,x()?Zt:Qt).join(""),t.href)}function Zt(t){if(function(t){return"selectorText"in t}(t)&&t.selectorText.includes(":")){const e=/(\[[\w-]+[^\\])(:[^\]]+\])/g;return t.cssText.replace(e,"$1\\$2")}return Qt(t)}function Qt(t){return function(t){return"styleSheet"in t}(t)&&Kt(t.styleSheet)||t.cssText}function te(t,e,n){const o=function(t,e,n){switch(t.nodeType){case t.DOCUMENT_NODE:return function(t,e,n){return{type:ot,childNodes:ee(t,e,n),adoptedStyleSheets:jt(t.adoptedStyleSheets)}}(t,e,n);case t.DOCUMENT_FRAGMENT_NODE:return function(t,e,n){const o=C(t);o&&n.serializationContext.shadowRootsController.addShadowRoot(t);return{type:ct,childNodes:ee(t,e,n),isShadowRoot:o,adoptedStyleSheets:o?jt(t.adoptedStyleSheets):void 0}}(t,e,n);case t.DOCUMENT_TYPE_NODE:return{type:st,name:(o=t).name,publicId:o.publicId,systemId:o.systemId};case t.ELEMENT_NODE:return function(t,e,n){const o=Yt(t.tagName),s=(a=t,"svg"===a.tagName||a instanceof SVGElement||void 0),i=b(N(t),e);var a;if(i===r.HIDDEN){const{width:e,height:n}=t.getBoundingClientRect();return{type:rt,tagName:o,attributes:{rr_width:`${e}px`,rr_height:`${n}px`,[y]:T},childNodes:[],isSVG:s}}if(i===r.IGNORE)return;const c=function(t,e,n){if(e===r.HIDDEN)return{};const o={},s=Yt(t.tagName),i=t.ownerDocument;for(let r=0;r<t.attributes.length;r+=1){const s=t.attributes.item(r).name,i=qt(t,e,s,n.configuration);null!==i&&(o[s]=i)}if(t.value&&("textarea"===s||"select"===s||"option"===s||"input"===s)){const n=Ft(t,e);void 0!==n&&(o.value=n)}if("option"===s&&e===r.ALLOW){const e=t;e.selected&&(o.selected=e.selected)}if("link"===s){const e=Array.from(i.styleSheets).find(e=>e.href===t.href),s=Kt(e);s&&e&&(Jt(n.serializationContext.serializationStats,"cssText",s.length),o._cssText=s)}if("style"===s&&t.sheet){const e=Kt(t.sheet);e&&(Jt(n.serializationContext.serializationStats,"cssText",e.length),o._cssText=e)}const a=t;if("input"!==s||"radio"!==a.type&&"checkbox"!==a.type||(e===r.ALLOW?o.checked=!!a.checked:m(a,e)&&delete o.checked),"audio"===s||"video"===s){const e=t;o.rr_mediaState=e.paused?"paused":"played"}let c,u;const d=n.serializationContext;switch(d.status){case 0:c=Math.round(t.scrollTop),u=Math.round(t.scrollLeft),(c||u)&&d.elementsScrollPositions.set(t,{scrollTop:c,scrollLeft:u});break;case 1:d.elementsScrollPositions.has(t)&&({scrollTop:c,scrollLeft:u}=d.elementsScrollPositions.get(t))}return u&&(o.rr_scrollLeft=u),c&&(o.rr_scrollTop=c),o}(t,i,n);let u=[];I(t)&&"style"!==o&&(u=ee(t,i,n));return{type:rt,tagName:o,attributes:c,childNodes:u,isSVG:s}}(t,e,n);case t.TEXT_NODE:return function(t,e){const n=E(t,e);if(void 0===n)return;return{type:it,textContent:n}}(t,e);case t.CDATA_SECTION_NODE:return{type:at,textContent:""}}var o}(t,e,n);if(!o)return null;const s=n.scope.nodeIds.assign(t),i=o;return i.id=s,n.serializedNodeIds&&n.serializedNodeIds.add(s),i}function ee(t,e,n){const o=[];return R(t,t=>{const s=te(t,e,n);s&&o.push(s)}),o}function ne(t,n,o,s){const r=e(),i=te(t,n.defaultPrivacyLevel,{serializationContext:s,configuration:n,scope:o});return Jt(s.serializationStats,"serializationDuration",D(r,e())),i}function oe(t,e,n,i=document){const a=t.defaultPrivacyLevel,c=new WeakMap,u=i!==document,{stop:l}=o(t,i,u?["change"]:["input","change"],t=>{const e=bt(t);(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement||e instanceof HTMLSelectElement)&&p(e)},{capture:!0,passive:!0});let f;if(u)f=d;else{const t=[_(HTMLInputElement.prototype,"value",p),_(HTMLInputElement.prototype,"checked",p),_(HTMLSelectElement.prototype,"value",p),_(HTMLTextAreaElement.prototype,"value",p),_(HTMLSelectElement.prototype,"selectedIndex",p)];f=()=>{t.forEach(t=>t.stop())}}return{stop:()=>{f(),l()}};function p(t){const n=s(t,a);if(n===r.HIDDEN)return;const o=t.type;let i;if("radio"===o||"checkbox"===o){if(m(t,n))return;i={isChecked:t.checked}}else{const e=Ft(t,n);if(void 0===e)return;i={text:e}}h(t,i,e);const c=t.name;"radio"===o&&c&&t.checked&&document.querySelectorAll(`input[type="radio"][name="${CSS.escape(c)}"]`).forEach(n=>{n!==t&&h(n,{isChecked:!1},e)})}function h(t,e,o){const s=o.nodeIds.get(t);if(void 0===s)return;const r=c.get(t);r&&r.text===e.text&&r.isChecked===e.isChecked||(c.set(t,e),n(It(mt,{id:s,...e})))}}function se(t,o,i,a,c){const u=M();if(!u)return{stop:d,flush:d};const l=function(t){let e=d,o=[];function s(){e(),t(o),o=[]}const{throttled:r,cancel:i}=n(s,16,{leading:!1});return{addMutations:t=>{0===o.length&&(e=L(r,{timeout:100})),o.push(...t)},flush:s,stop:()=>{e(),i()}}}(n=>{!function(t,n,o,i,a){const c=new Map;t.filter(t=>"childList"===t.type).forEach(t=>{t.removedNodes.forEach(t=>{re(t,a.removeShadowRoot)})});const u=t.filter(t=>t.target.isConnected&&i.nodeIds.areAssignedForNodeAndAncestors(t.target)&&s(t.target,o.defaultPrivacyLevel,c)!==r.HIDDEN),d={cssText:{count:0,max:0,sum:0},serializationDuration:{count:0,max:0,sum:0}},{adds:l,removes:f,hasBeenSerialized:p}=function(t,n,o,i,a,c){const u=new Set,d=new Map;for(const e of t)e.addedNodes.forEach(t=>{u.add(t)}),e.removedNodes.forEach(t=>{u.has(t)||d.set(t,e.target),u.delete(t)});const l=Array.from(u);f=l,f.sort((t,e)=>{const n=t.compareDocumentPosition(e);return n&Node.DOCUMENT_POSITION_CONTAINED_BY?-1:n&Node.DOCUMENT_POSITION_CONTAINS||n&Node.DOCUMENT_POSITION_FOLLOWING?1:n&Node.DOCUMENT_POSITION_PRECEDING?-1:0});var f;const p=new Set,m={status:2,serializationStats:i,shadowRootsController:a},h=[];for(const w of l){if(y(w))continue;const t=s(w.parentNode,n.defaultPrivacyLevel,c);if(t===r.HIDDEN||t===r.IGNORE)continue;const a=e(),u=te(w,t,{serializedNodeIds:p,serializationContext:m,configuration:n,scope:o});if(Jt(i,"serializationDuration",D(a,e())),!u)continue;const d=z(w);h.push({nextId:v(w),parentId:o.nodeIds.get(d),node:u})}const g=[];return d.forEach((t,e)=>{const n=o.nodeIds.get(t),s=o.nodeIds.get(e);void 0!==n&&void 0!==s&&g.push({parentId:n,id:s})}),{adds:h,removes:g,hasBeenSerialized:y};function y(t){const e=o.nodeIds.get(t);return void 0!==e&&p.has(e)}function v(t){let e=t.nextSibling;for(;e;){const t=o.nodeIds.get(e);if(void 0!==t)return t;e=e.nextSibling}return null}}(u.filter(t=>"childList"===t.type),o,i,d,a,c),m=function(t,e,n,o){var i;const a=[],c=new Set,u=t.filter(t=>!c.has(t.target)&&(c.add(t.target),!0));for(const d of u){if(d.target.textContent===d.oldValue)continue;const t=n.nodeIds.get(d.target);if(void 0===t)continue;const c=s(z(d.target),e.defaultPrivacyLevel,o);c!==r.HIDDEN&&c!==r.IGNORE&&a.push({id:t,value:null!==(i=E(d.target,c))&&void 0!==i?i:null})}return a}(u.filter(t=>"characterData"===t.type&&!p(t.target)),o,i,c),h=function(t,e,n,o){const r=[],i=new Map,a=t.filter(t=>{const e=i.get(t.target);return(!e||!e.has(t.attributeName))&&(e?e.add(t.attributeName):i.set(t.target,new Set([t.attributeName])),!0)}),c=new Map;for(const u of a){if(u.target.getAttribute(u.attributeName)===u.oldValue)continue;const t=n.nodeIds.get(u.target);if(void 0===t)continue;const i=s(u.target,e.defaultPrivacyLevel,o),a=qt(u.target,i,u.attributeName,e);let d;if("value"===u.attributeName){const t=Ft(u.target,i);if(void 0===t)continue;d=t}else d="string"==typeof a?a:null;let l=c.get(u.target);l||(l={id:t,attributes:{}},r.push(l),c.set(u.target,l)),l.attributes[u.attributeName]=d}return r}(u.filter(t=>"attributes"===t.type&&!p(t.target)),o,i,c);if(!(m.length||h.length||f.length||l.length))return;n(It(ut,{adds:l,removes:f,texts:m,attributes:h}),d)}(n.concat(f.takeRecords()),t,o,i,a)}),f=new u(O(l.addMutations));return f.observe(c,{attributeOldValue:!0,attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),{stop:()=>{f.disconnect(),l.stop()},flush:()=>{l.flush()}}}function re(e,n){t(e)&&n(e.shadowRoot),R(e,t=>re(t,n))}function ie(t){const{emit:n,configuration:o,lifeCycle:s}=t;if(!n)throw new Error("emit function is required");const r=(e,o)=>{n(e,o),k("record",{record:e});const s=t.viewHistory.findView();P(s.id)},c=function(){const t=new WeakMap;return{set(e,n){(e!==document||document.scrollingElement)&&t.set(e===document?document.scrollingElement:e,n)},get:e=>t.get(e),has:e=>t.has(e)}}(),u={nodeIds:function(){const t=new WeakMap;let e=1;const n=e=>t.get(e);return{assign:o=>{let s=n(o);return void 0===s&&(s=e++,t.set(o,s)),s},get:n,areAssignedForNodeAndAncestors:t=>{let e=t;for(;e;){if(void 0===n(e)&&!C(e))return!1;e=z(e)}return!0}}}()};const d=((t,e,n,o)=>{const s=new Map,r={addShadowRoot:i=>{if(s.has(i))return;const a=se(n,t,e,r,i),c=oe(t,e,n,i),u=Lt(t,e,n,o,i);s.set(i,{flush:()=>a.flush(),stop:()=>{a.stop(),c.stop(),u.stop()}})},removeShadowRoot:t=>{const e=s.get(t);e&&(e.stop(),s.delete(t))},stop:()=>{s.forEach(({stop:t})=>t())},flush:()=>{s.forEach(({flush:t})=>t())}};return r})(o,u,r,c),{stop:l}=function(t,n,o,s,r,c,u){const d=(e,o)=>{const{width:c,height:d}=A();u({data:{height:d,href:window.location.href,width:c},type:Z,timestamp:e}),u({data:{has_focus:document.hasFocus()},type:Q,timestamp:e});const l={cssText:{count:0,max:0,sum:0},serializationDuration:{count:0,max:0,sum:0}};u({data:{node:ne(document,s,r,{status:o,elementsScrollPositions:t,serializationStats:l,shadowRootsController:n}),initialOffset:{left:a(),top:i()}},type:J,timestamp:e},l),window.visualViewport&&u({data:Tt(window.visualViewport),type:et,timestamp:e})};d(e(),0);const{unsubscribe:l}=o.subscribe(2,t=>{c(),d(t.startClocks.timeStamp,1)});return{stop:l}}(c,d,s,o,u,f,r);function f(){d.flush(),m.flush()}const p=function(){const t=new WeakMap;let e=1;return{getIdForEvent:n=>(t.has(n)||t.set(n,e++),t.get(n))}}(),m=se(r,o,u,d,document),h=[m,Ct(o,u,r),_t(o,u,r,p),Lt(o,u,r,c,document),Mt(o,r),oe(o,u,r),zt(o,u,r),At(u,r),Pt(o,r),Ot(o,r),Vt(s,r,p),Ht(s,t=>{f(),r(t)})];return{stop:()=>{d.stop(),h.forEach(t=>t.stop()),l()},flushMutations:f,shadowRootsController:d}}function ae({context:t,creationReason:e,encoder:n}){let o=0;const s=t.view.id,r={start:1/0,end:-1/0,creation_reason:e,records_count:0,has_full_snapshot:!1,index_in_view:V(s),source:"browser",...t},i={cssText:{count:0,max:0,sum:0},serializationDuration:{count:0,max:0,sum:0}};return H(s),{addRecord:function(t,e,s){r.start=Math.min(r.start,t.timestamp),r.end=Math.max(r.end,t.timestamp),r.records_count+=1,r.has_full_snapshot||(r.has_full_snapshot=t.type===J),e&&function(t,e){for(const n of["cssText","serializationDuration"])t[n].count+=e[n].count,t[n].max=Math.max(t[n].max,e[n].max),t[n].sum+=e[n].sum}(i,e);const a=n.isEmpty?'{"records":[':",";n.write(a+JSON.stringify(t),t=>{o+=t,s(o)})},flush:function(t){if(n.isEmpty)throw new Error("Empty segment flushed");n.write(`],${JSON.stringify(r).slice(1)}\n`),n.finish(e=>{F(r.view.id,e.rawBytesCount),t(r,i,e)})}}}const ce=5*U;let ue=6e4;function de(t,e,n,o,s,r){return function(t,e,n,o){let s={status:0,nextSegmentCreationReason:"init"};const{unsubscribe:r}=t.subscribe(2,()=>{a("view_change")}),{unsubscribe:i}=t.subscribe(11,t=>{a(t.reason)});function a(t){1===s.status&&(s.segment.flush((e,o,s)=>{const r=function(t,e,n,o){const s=new FormData;s.append("segment",new Blob([t],{type:"application/octet-stream"}),`${e.session.id}-${e.start}`);const r={raw_segment_size:o,compressed_segment_size:t.byteLength,...e},i=JSON.stringify(r);return s.append("event",new Blob([i],{type:"application/json"})),{data:s,bytesCount:t.byteLength,cssText:n.cssText,isFullSnapshot:0===e.index_in_view,rawSize:o,recordCount:e.records_count,serializationDuration:n.serializationDuration}}(s.output,e,o,s.rawBytesCount);$(t)?n.sendOnExit(r):n.send(r)}),B(s.expirationTimeoutId)),s="stop"!==t?{status:0,nextSegmentCreationReason:t}:{status:2}}return{addRecord:(t,n)=>{if(2!==s.status){if(0===s.status){const t=e();if(!t)return;s={status:1,segment:ae({encoder:o,context:t,creationReason:s.nextSegmentCreationReason}),expirationTimeoutId:G(()=>{a("segment_duration_limit")},ce)}}s.segment.addRecord(t,n,t=>{t>ue&&a("segment_bytes_limit")})}},stop:()=>{a("stop"),r(),i()}}}(t,()=>function(t,e,n){const o=e.findTrackedSession(),s=n.findView();if(!o||!s)return;return{application:{id:t},session:{id:o.id},view:{id:s.id}}}(e.applicationId,n,o),s,r)}function le(t,e,n,o,s,r,i){const a=[],c=i||X([e.sessionReplayEndpointBuilder],ue,e=>{t.notify(14,{error:e}),q("Error reported to customer",{"error.message":e.message})});let u;if(j())({addRecord:u}=function(t){const e=Y();return{addRecord:n=>{const o=t.findView();e.send("record",n,o.id)}}}(o));else{const i=de(t,e,n,o,c,s);u=i.addRecord,a.push(i.stop);const l=function(t,e){if(!t.metricsEnabled)return{stop:d};const{unsubscribe:n}=e.subscribe(t=>{if("failure"===t.type||"queue-full"===t.type||"success"===t.type&&t.payload.isFullSnapshot){const s=(e=t.type,n=t.bandwidth,{cssText:{count:(o=t.payload).cssText.count,max:o.cssText.max,sum:o.cssText.sum},isFullSnapshot:o.isFullSnapshot,ongoingRequests:{count:n.ongoingRequestCount,totalSize:n.ongoingByteCount},recordCount:o.recordCount,result:e,serializationDuration:{count:o.serializationDuration.count,max:o.serializationDuration.max,sum:o.serializationDuration.sum},size:{compressed:o.bytesCount,raw:o.rawSize}});W("Segment network request metrics",{metrics:s})}var e,n,o});return{stop:n}}(r,c.observable);a.push(l.stop)}const{stop:l}=ie({emit:u,configuration:e,lifeCycle:t,viewHistory:o});return a.push(l),{stop:()=>{a.forEach(t=>t())}}}export{le as startRecording};
