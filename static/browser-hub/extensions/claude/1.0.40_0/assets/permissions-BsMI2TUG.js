function e(e,t){for(var r=0;r<t.length;r++){const n=t[r];if("string"!=typeof n&&!Array.isArray(n))for(const t in n)if("default"!==t&&!(t in e)){const r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var r=function e(){var r=!1;try{r=this instanceof e}catch{}return r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,n.get?n:{enumerable:!0,get:function(){return e[t]}})}),r}var a,o,s={exports:{}},i={};function c(){return o||(o=1,s.exports=function(){if(a)return i;a=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function r(t,r,n){var a=null;if(void 0!==n&&(a=""+n),void 0!==r.key&&(a=""+r.key),"key"in r)for(var o in n={},r)"key"!==o&&(n[o]=r[o]);else n=r;return r=n.ref,{$$typeof:e,type:t,key:a,ref:void 0!==r?r:null,props:n}}return i.Fragment=t,i.jsx=r,i.jsxs=r,i}()),s.exports}var u,l,f=c(),d={exports:{}},p={};function h(){if(u)return p;u=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),s=Symbol.for("react.context"),i=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),d=Symbol.for("react.activity"),h=Symbol.iterator;var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,E={};function _(e,t,r){this.props=e,this.context=t,this.refs=E,this.updater=r||y}function w(){}function g(e,t,r){this.props=e,this.context=t,this.refs=E,this.updater=r||y}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},w.prototype=_.prototype;var S=g.prototype=new w;S.constructor=g,m(S,_.prototype),S.isPureReactComponent=!0;var T=Array.isArray;function b(){}var A={H:null,A:null,T:null,S:null},v=Object.prototype.hasOwnProperty;function O(t,r,n){var a=n.ref;return{$$typeof:e,type:t,key:r,ref:void 0!==a?a:null,props:n}}function R(t){return"object"==typeof t&&null!==t&&t.$$typeof===e}var P=/\/+/g;function I(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,n={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return n[e]})):t.toString(36);var r,n}function D(r,n,a,o,s){var i=typeof r;"undefined"!==i&&"boolean"!==i||(r=null);var c,u,l=!1;if(null===r)l=!0;else switch(i){case"bigint":case"string":case"number":l=!0;break;case"object":switch(r.$$typeof){case e:case t:l=!0;break;case f:return D((l=r._init)(r._payload),n,a,o,s)}}if(l)return s=s(r),l=""===o?"."+I(r,0):o,T(s)?(a="",null!=l&&(a=l.replace(P,"$&/")+"/"),D(s,n,a,"",function(e){return e})):null!=s&&(R(s)&&(c=s,u=a+(null==s.key||r&&r.key===s.key?"":(""+s.key).replace(P,"$&/")+"/")+l,s=O(c.type,u,c.props)),n.push(s)),1;l=0;var d,p=""===o?".":o+":";if(T(r))for(var y=0;y<r.length;y++)l+=D(o=r[y],n,a,i=p+I(o,y),s);else if("function"==typeof(y=null===(d=r)||"object"!=typeof d?null:"function"==typeof(d=h&&d[h]||d["@@iterator"])?d:null))for(r=y.call(r),y=0;!(o=r.next()).done;)l+=D(o=o.value,n,a,i=p+I(o,y++),s);else if("object"===i){if("function"==typeof r.then)return D(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(b,b):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(r),n,a,o,s);throw n=String(r),Error("Objects are not valid as a React child (found: "+("[object Object]"===n?"object with keys {"+Object.keys(r).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.")}return l}function C(e,t,r){if(null==e)return e;var n=[],a=0;return D(e,n,"","",function(e){return t.call(r,e,a++)}),n}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var N="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit)return void process.emit("uncaughtException",e)},U={map:C,forEach:function(e,t,r){C(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return C(e,function(){t++}),t},toArray:function(e){return C(e,function(e){return e})||[]},only:function(e){if(!R(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};return p.Activity=d,p.Children=U,p.Component=_,p.Fragment=r,p.Profiler=a,p.PureComponent=g,p.StrictMode=n,p.Suspense=c,p.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,p.__COMPILER_RUNTIME={__proto__:null,c:function(e){return A.H.useMemoCache(e)}},p.cache=function(e){return function(){return e.apply(null,arguments)}},p.cacheSignal=function(){return null},p.cloneElement=function(e,t,r){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var n=m({},e.props),a=e.key;if(null!=t)for(o in void 0!==t.key&&(a=""+t.key),t)!v.call(t,o)||"key"===o||"__self"===o||"__source"===o||"ref"===o&&void 0===t.ref||(n[o]=t[o]);var o=arguments.length-2;if(1===o)n.children=r;else if(1<o){for(var s=Array(o),i=0;i<o;i++)s[i]=arguments[i+2];n.children=s}return O(e.type,a,n)},p.createContext=function(e){return(e={$$typeof:s,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:o,_context:e},e},p.createElement=function(e,t,r){var n,a={},o=null;if(null!=t)for(n in void 0!==t.key&&(o=""+t.key),t)v.call(t,n)&&"key"!==n&&"__self"!==n&&"__source"!==n&&(a[n]=t[n]);var s=arguments.length-2;if(1===s)a.children=r;else if(1<s){for(var i=Array(s),c=0;c<s;c++)i[c]=arguments[c+2];a.children=i}if(e&&e.defaultProps)for(n in s=e.defaultProps)void 0===a[n]&&(a[n]=s[n]);return O(e,o,a)},p.createRef=function(){return{current:null}},p.forwardRef=function(e){return{$$typeof:i,render:e}},p.isValidElement=R,p.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:k}},p.memo=function(e,t){return{$$typeof:l,type:e,compare:void 0===t?null:t}},p.startTransition=function(e){var t=A.T,r={};A.T=r;try{var n=e(),a=A.S;null!==a&&a(r,n),"object"==typeof n&&null!==n&&"function"==typeof n.then&&n.then(b,N)}catch(o){N(o)}finally{null!==t&&null!==r.types&&(t.types=r.types),A.T=t}},p.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},p.use=function(e){return A.H.use(e)},p.useActionState=function(e,t,r){return A.H.useActionState(e,t,r)},p.useCallback=function(e,t){return A.H.useCallback(e,t)},p.useContext=function(e){return A.H.useContext(e)},p.useDebugValue=function(){},p.useDeferredValue=function(e,t){return A.H.useDeferredValue(e,t)},p.useEffect=function(e,t){return A.H.useEffect(e,t)},p.useEffectEvent=function(e){return A.H.useEffectEvent(e)},p.useId=function(){return A.H.useId()},p.useImperativeHandle=function(e,t,r){return A.H.useImperativeHandle(e,t,r)},p.useInsertionEffect=function(e,t){return A.H.useInsertionEffect(e,t)},p.useLayoutEffect=function(e,t){return A.H.useLayoutEffect(e,t)},p.useMemo=function(e,t){return A.H.useMemo(e,t)},p.useOptimistic=function(e,t){return A.H.useOptimistic(e,t)},p.useReducer=function(e,t,r){return A.H.useReducer(e,t,r)},p.useRef=function(e){return A.H.useRef(e)},p.useState=function(e){return A.H.useState(e)},p.useSyncExternalStore=function(e,t,r){return A.H.useSyncExternalStore(e,t,r)},p.useTransition=function(){return A.H.useTransition()},p.version="19.2.1",p}function y(){return l||(l=1,d.exports=h()),d.exports}var m=y();const E=r(m),_=e({__proto__:null,default:E},[m]);function w(e){let t,r,n,a=!1;return function(o){void 0===t?(t=o,r=0,n=-1):t=function(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(t,o);const s=t.length;let i=0;for(;r<s;){a&&(10===t[r]&&(i=++r),a=!1);let o=-1;for(;r<s&&-1===o;++r)switch(t[r]){case 58:-1===n&&(n=r-i);break;case 13:a=!0;case 10:o=r}if(-1===o)break;e(t.subarray(i,o),n),i=r,n=-1}i===s?t=void 0:0!==i&&(t=t.subarray(i),r-=i)}}const g="text/event-stream",S="last-event-id";function T(e,t){var{signal:r,headers:n,onopen:a,onmessage:o,onclose:s,onerror:i,openWhenHidden:c,fetch:u}=t,l=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((t,f)=>{const d=Object.assign({},n);let p;function h(){p.abort(),document.hidden||A()}d.accept||(d.accept=g),c||document.addEventListener("visibilitychange",h);let y=1e3,m=0;function E(){document.removeEventListener("visibilitychange",h),window.clearTimeout(m),p.abort()}null==r||r.addEventListener("abort",()=>{E(),t()});const _=null!=u?u:window.fetch,T=null!=a?a:b;async function A(){var r;p=new AbortController;try{const r=await _(e,Object.assign(Object.assign({},l),{headers:d,signal:p.signal}));await T(r),await async function(e,t){const r=e.getReader();let n;for(;!(n=await r.read()).done;)t(n.value)}(r.body,w(function(e,t,r){let n={data:"",event:"",id:"",retry:void 0};const a=new TextDecoder;return function(o,s){if(0===o.length)null==r||r(n),n={data:"",event:"",id:"",retry:void 0};else if(s>0){const r=a.decode(o.subarray(0,s)),i=s+(32===o[s+1]?2:1),c=a.decode(o.subarray(i));switch(r){case"data":n.data=n.data?n.data+"\n"+c:c;break;case"event":n.event=c;break;case"id":e(n.id=c);break;case"retry":const r=parseInt(c,10);isNaN(r)||t(n.retry=r)}}}}(e=>{e?d[S]=e:delete d[S]},e=>{y=e},o))),null==s||s(),E(),t()}catch(n){if(!p.signal.aborted)try{const e=null!==(r=null==i?void 0:i(n))&&void 0!==r?r:y;window.clearTimeout(m),m=window.setTimeout(A,e)}catch(a){E(),f(a)}}}A()})}function b(e){const t=e.headers.get("content-type");if(!(null==t?void 0:t.startsWith(g)))throw new Error(`Expected content-type to be ${g}, Actual: ${t}`)}const A={production:{SEGMENT_WRITE_KEY:"H7hVDRIBUrlBySLqJ15oAivgqhomdAKT"},development:{SEGMENT_WRITE_KEY:"hNex10EGp3coubOXQI1BIElYaZcA1o0u"}},v="fcoeoabgfenejglbffodgkkbkcdhcgfn",O={AUTHORIZE_URL:"https://claude.ai/oauth/authorize",TOKEN_URL:"https://platform.claude.com/v1/oauth/token",SCOPES_STR:"user:profile user:inference user:chat",CLIENT_ID:"54511e87-7abf-4923-9d84-d6f24532e871",REDIRECT_URI:`chrome-extension://${"dihbgbndebgnbjfmelmegjepbnkhlgni"}/oauth_callback.html`},R={development:O,production:{...O,CLIENT_ID:"dae2cad8-15c5-43d2-9046-fcaecc135fa4",REDIRECT_URI:`chrome-extension://${v}/oauth_callback.html`}},P=()=>{const e="production",t=R[e];return{environment:e,apiBaseUrl:"https://api.anthropic.com",wsApiBaseUrl:"wss://api.anthropic.com",segmentWriteKey:A[e].SEGMENT_WRITE_KEY,oauth:t}};var I=(e=>(e.ACCESS_TOKEN="accessToken",e.REFRESH_TOKEN="refreshToken",e.TOKEN_EXPIRY="tokenExpiry",e.OAUTH_STATE="oauthState",e.CODE_VERIFIER="codeVerifier",e.ANTHROPIC_API_KEY="anthropicApiKey",e.SELECTED_MODEL="selectedModel",e.SYSTEM_PROMPT="systemPrompt",e.DEBUG_MODE="debugMode",e.MODEL_SELECTOR_DEBUG="modelSelectorDebug",e.SHOW_TRACE_IDS="showTraceIds",e.SHOW_SYSTEM_REMINDERS="showSystemReminders",e.USE_SESSIONS_API="useSessionsAPI",e.SESSIONS_API_HOSTNAME="sessionsApiHostname",e.BROWSER_CONTROL_PERMISSION_ACCEPTED="browserControlPermissionAccepted",e.PERMISSION_STORAGE="permissionStorage",e.LAST_PERMISSION_MODE_PREFERENCE="lastPermissionModePreference",e.ANONYMOUS_ID="anonymousId",e.TEST_DATA_MESSAGES="test_data_messages",e.SCHEDULED_TASK_LOGS="scheduledTaskLogs",e.SCHEDULED_TASK_STATS="scheduledTaskStats",e.PENDING_SCHEDULED_TASK="pendingScheduledTask",e.TARGET_TAB_ID="targetTabId",e.UPDATE_AVAILABLE="updateAvailable",e.TIP_DISPLAY_COUNTS="tipDisplayCounts",e.NEW_TAB_NOTE="newTabNote",e.CUSTOM_APP_LINKS="customAppLinks",e.NOTIFICATIONS_ENABLED="notificationsEnabled",e.ANNOUNCEMENT_DISMISSED="announcementDismissed",e.MODEL_OVERRIDE_SEEN="modelOverrideSeen",e.SAVED_PROMPTS="savedPrompts",e.SAVED_PROMPT_CATEGORIES="savedPromptCategories",e.TAB_GROUPS="tabGroups",e.DISMISSED_TAB_GROUPS="dismissedTabGroups",e.MCP_TAB_GROUP_ID="mcpTabGroupId",e.MCP_CONNECTED="mcpConnected",e.WIDGET_ORDER="widgetOrder",e))(I||{});async function D(e,t){const r=await chrome.storage.local.get(e);return void 0!==r[e]?r[e]:t}async function C(e,t){await chrome.storage.local.set({[e]:t})}async function k(e){const t=Array.isArray(e)?e:[e];await chrome.storage.local.remove(t)}async function N(e){return await chrome.storage.local.get(e)}async function U(e){await chrome.storage.local.set(e)}const x=new Set(["anonymousId","updateAvailable"]);async function M(){const e=Object.values(I).filter(e=>!x.has(e));await k(e)}const L=e=>btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),j=async(e,t)=>{await U({[I.ACCESS_TOKEN]:e.accessToken,[I.REFRESH_TOKEN]:e.refreshToken,[I.TOKEN_EXPIRY]:e.expiresAt,[I.OAUTH_STATE]:t})},H=async(e,t)=>{try{const r=await fetch(t.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",client_id:t.CLIENT_ID,refresh_token:e})});if(!r.ok){const e=await r.text();return{success:!1,error:`Token refresh failed: ${r.status} ${e}`}}const n=await r.json();return n.error?{success:!1,error:n.error_description||n.error}:{success:!0,accessToken:n.access_token,refreshToken:n.refresh_token||e,expiresAt:n.expires_in?Date.now()+1e3*n.expires_in:void 0}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Network error during token refresh"}}},F=async()=>{try{const e=await N([I.ACCESS_TOKEN,I.REFRESH_TOKEN,I.TOKEN_EXPIRY]);if(!e[I.ACCESS_TOKEN])return{isValid:!1,isRefreshed:!1};const t=Date.now(),r=e[I.TOKEN_EXPIRY],n=!!r&&t<r;if(!(!!r&&t>=r-36e5))return{isValid:n,isRefreshed:!1};if(!e[I.REFRESH_TOKEN])return{isValid:n,isRefreshed:!1};const a=P();for(let o=0;o<3;o++){const t=await H(e[I.REFRESH_TOKEN],a.oauth);if(t.success)return await j(t),{isValid:!0,isRefreshed:!0};if(2===o)return await k([I.ACCESS_TOKEN,I.REFRESH_TOKEN,I.TOKEN_EXPIRY]),{isValid:n,isRefreshed:!1}}return{isValid:n,isRefreshed:!1}}catch{return{isValid:!1,isRefreshed:!1}}},$=async()=>{if(!(await F()).isValid)return;return await D(I.ACCESS_TOKEN)||void 0},V=async(e,t)=>{try{const r=new URLSearchParams(new URL(e).search),n=r.get("code"),a=r.get("error"),o=r.get("error_description"),s=r.get("state");if(a){return{success:!1,error:`Authentication failed: ${a}${o?" - "+o:""}`}}if(!n)return{success:!1,error:"No authorization code received"};const i=await D(I.CODE_VERIFIER)||"",c=P(),u=await(async(e,t,r,n)=>{try{const a=await fetch(n.TOKEN_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",client_id:n.CLIENT_ID,code:e,redirect_uri:n.REDIRECT_URI,state:t,code_verifier:r})});if(!a.ok){const e=await a.text();return{success:!1,error:`Token exchange failed: ${a.status} ${e}`}}const o=await a.json();return o.error?{success:!1,error:o.error_description||o.error}:{success:!0,accessToken:o.access_token,refreshToken:o.refresh_token,expiresAt:o.expires_in?Date.now()+1e3*o.expires_in:void 0}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Network error during token exchange"}}})(n,s||"",i,c.oauth);if(u.success){await j(u,s||void 0);const e="https://claude.ai/chrome/installed";return t&&await chrome.tabs.update(t,{url:e}),{success:!0,message:"Authentication successful!"}}return{success:!1,error:u.error||"Failed to exchange authorization code for token"}}catch(r){return{success:!1,error:r instanceof Error?r.message:"An unexpected error occurred during authentication"}}},K=async()=>{await M()},G=async()=>{const e=P(),t=(e=>{const t=new Uint8Array(e);return crypto.getRandomValues(t),L(t)})(32),r=L(crypto.getRandomValues(new Uint8Array(32))),n=await(async e=>{const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t);return L(new Uint8Array(r))})(r);await U({[I.OAUTH_STATE]:t,[I.CODE_VERIFIER]:r});const a=new URLSearchParams({client_id:e.oauth.CLIENT_ID,response_type:"code",scope:e.oauth.SCOPES_STR,redirect_uri:e.oauth.REDIRECT_URI,state:t,code_challenge:n,code_challenge_method:"S256"}),o=`${e.oauth.AUTHORIZE_URL}?${a.toString()}`;chrome.tabs.create({url:o})};const Y=new class{baseURL;constructor(){const e=P();this.baseURL=e.apiBaseUrl}async fetch(e,t={}){const r=await $();if(!r)throw new Error("No valid OAuth token available");const n=`${this.baseURL}${e}`,a={Authorization:`Bearer ${r}`,"Content-Type":"application/json","anthropic-client-platform":"claude_browser_extension",...t.headers},o=await fetch(n,{...t,headers:a});if(!o.ok)throw new Error(`API request failed: ${o.status} ${o.statusText}`);const s=o.headers.get("content-type");return 204===o.status?null:s?.includes("application/json")?o.json():s?o.blob():null}async fetchEventSource(e,t){const r=await $();if(!r)throw new Error("No valid OAuth token available for SSE stream");const n=`${this.baseURL}${e}`,a=new AbortController;return await T(n,{...t,headers:{Authorization:`Bearer ${r}`,"anthropic-client-platform":"claude_browser_extension",...t.headers},signal:t.signal||a.signal}),()=>{a.abort()}}};class B{config;features=null;cacheTimestamp=null;initPromise=null;isRefreshing=!1;constructor(e){this.config={...e,cacheTTL:e.cacheTTL??3e5,storageKey:e.storageKey??"features"}}setOnFeaturesUpdated(e){this.config.onFeaturesUpdated=e}async loadFromCache(){try{const e=(await chrome.storage.local.get(this.config.storageKey))[this.config.storageKey];if(e&&e.payload&&e.timestamp){if(Date.now()-e.timestamp<this.config.cacheTTL)return e}}catch(e){}return null}async saveToCache(e){try{const t={payload:e,timestamp:Date.now()};await chrome.storage.local.set({[this.config.storageKey]:t})}catch(t){}}async fetchAndUpdate(){try{const e=await this.config.fetchFeatures();this.features=e.features,this.cacheTimestamp=Date.now(),await this.saveToCache(e),this.config.onFeaturesUpdated?.(e.features)}catch(e){throw e}}checkAndRefreshIfStale(){if(!this.cacheTimestamp||this.isRefreshing)return;return Date.now()-this.cacheTimestamp>this.config.cacheTTL?(this.isRefreshing=!0,this.fetchAndUpdate().catch(e=>{}).finally(()=>{this.isRefreshing=!1})):void 0}async initialize(){if(!this.features)return this.initPromise||(this.initPromise=(async()=>{const e=await this.loadFromCache();if(e){this.features=e.payload.features,this.cacheTimestamp=e.timestamp,this.config.onFeaturesUpdated?.(e.payload.features);if(Date.now()-e.timestamp>this.config.cacheTTL/2){this.isRefreshing=!0;try{await this.fetchAndUpdate()}catch(t){}finally{this.isRefreshing=!1}}return}try{await this.fetchAndUpdate()}catch{}})()),this.initPromise}getFeatureValue(e,t){this.checkAndRefreshIfStale();const r=this.features?.[e];return r&&void 0!==r.value&&null!==r.value?r.value:t}async getFeatureValueAsync(e,t){await this.checkAndRefreshIfStale();const r=this.features?.[e];return r&&void 0!==r.value&&null!==r.value?r.value:t}isFeatureEnabled(e){this.checkAndRefreshIfStale();const t=this.features?.[e];return t?.on??!1}async isFeatureEnabledAsync(e){await this.checkAndRefreshIfStale();const t=this.features?.[e];return t?.on??!1}getFeature(e){return this.checkAndRefreshIfStale(),this.features?.[e]}async getFeatureAsync(e){return await this.checkAndRefreshIfStale(),this.features?.[e]}async refresh(){await this.fetchAndUpdate()}isReady(){return null!==this.features}}async function W(){return Y.fetch("/api/bootstrap/features/claude_in_chrome")}let z=null;const q=m.createContext(null);function X({children:e}){const[t,r]=m.useState(null),[n,a]=m.useState(!1),[o,s]=m.useState(null),i=m.useRef(null);m.useEffect(()=>{const e=e=>{r(e),s(null)},t=(n=e,z||(z=new B({fetchFeatures:W,onFeaturesUpdated:n})),z);var n;i.current=t,t.setOnFeaturesUpdated(e),t.initialize().then(()=>{a(!0)}).catch(e=>{s(e instanceof Error?e:new Error(String(e))),a(!0)})},[]);const c=m.useCallback((e,t)=>i.current?i.current.getFeatureValue(e,t):t,[t]),u=m.useCallback(e=>!!i.current&&i.current.isFeatureEnabled(e),[t]),l=m.useCallback(e=>{if(i.current)return i.current.getFeature(e)},[t]),d=m.useCallback(e=>void 0!==t?.[e],[t]),p=m.useCallback(async()=>{i.current&&await i.current.refresh()},[]),h=m.useMemo(()=>({isReady:n,error:o,getFeatureValue:c,isFeatureEnabled:u,getFeature:l,hasFeature:d,refresh:p}),[n,o,c,u,l,d,p]);return f.jsx(q.Provider,{value:h,children:e})}function J(){const e=m.useContext(q);if(!e)throw new Error("useFeatures must be used within a FeatureProvider");return e}function Q(e,t){const{getFeatureValue:r}=J();return r(e,t)}function Z(e){const{isFeatureEnabled:t}=J();return t(e)}function ee(){const{isReady:e}=J();return e}const te={},re=function(e,t,r){let n=Promise.resolve();if(t&&t.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=r?.nonce||r?.getAttribute("nonce");n=e(t.map(e=>{if((e=function(e){return"/"+e}(e))in te)return;te[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,a&&n.setAttribute("nonce",a),document.head.appendChild(n),t?new Promise((t,r)=>{n.addEventListener("load",t),n.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return n.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};var ne=function(e,t){return(ne=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function ae(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}ne(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var oe=function(){return oe=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},oe.apply(this,arguments)};function se(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}function ie(e,t,r,n){return new(r||(r=Promise))(function(a,o){function s(e){try{c(n.next(e))}catch(t){o(t)}}function i(e){try{c(n.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}c((n=n.apply(e,t||[])).next())})}function ce(e,t){var r,n,a,o,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(s=0)),s;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(c){i=[6,c],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}function ue(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))}function le(e,t,r){t.split&&(t=t.split("."));for(var n,a,o=0,s=t.length,i=e;o<s&&"__proto__"!=(a=""+t[o++])&&"constructor"!==a&&"prototype"!==a;)i=i[a]=o===s?r:typeof(n=i[a])==typeof t?n:0*t[o]!=0||~(""+t[o]).indexOf(".")?{}:[]}for(var fe,de=256,pe=[];de--;)pe[de]=(de+256).toString(16).substring(1);function he(){var e,t=0,r="";if(!fe||de+16>256){for(fe=Array(t=256);t--;)fe[t]=256*Math.random()|0;t=de=0}for(;t<16;t++)e=fe[de+t],r+=6==t?pe[15&e|64]:8==t?pe[63&e|128]:pe[e],1&t&&t>1&&t<11&&(r+="-");return de++,r}class ye{static async getAllPrompts(){return await D(I.SAVED_PROMPTS)||[]}static async getPromptById(e){return(await this.getAllPrompts()).find(t=>t.id===e)}static async getPromptByCommand(e){return(await this.getAllPrompts()).find(t=>t.command===e)}static async savePrompt(e){const t=await this.getAllPrompts();if(e.command){if(t.find(t=>t.command===e.command))throw new Error(`/${e.command} is already in use`)}const r={...e,id:`prompt_${Date.now()}`,createdAt:e.createdAt||Date.now(),usageCount:e.usageCount||0};return t.push(r),await C(I.SAVED_PROMPTS,t),r.repeatType&&"none"!==r.repeatType&&await this.updateAlarmForPrompt(r),r}static async updatePrompt(e,t){const r=await this.getAllPrompts(),n=r.findIndex(t=>t.id===e);if(-1===n)return;if(t.command&&t.command!==r[n].command){if(r.find(e=>e.command===t.command))throw new Error(`/${t.command} is already in use`)}const a=r[n];r[n]={...r[n],...t},await C(I.SAVED_PROMPTS,r);const o=r[n];return a.repeatType===o.repeatType&&a.specificTime===o.specificTime&&a.specificDate===o.specificDate&&a.dayOfWeek===o.dayOfWeek&&a.dayOfMonth===o.dayOfMonth&&a.monthAndDay===o.monthAndDay||await this.updateAlarmForPrompt(o),r[n]}static async deletePrompt(e){const t=await this.getAllPrompts(),r=t.find(t=>t.id===e),n=t.filter(t=>t.id!==e);return n.length!==t.length&&(r?.repeatType&&"none"!==r.repeatType&&await chrome.alarms.clear(e),await C(I.SAVED_PROMPTS,n),!0)}static async recordPromptUsage(e){const t=await this.getAllPrompts(),r=t.find(t=>t.id===e);r&&(r.lastUsedAt=Date.now(),r.usageCount=(r.usageCount||0)+1,await C(I.SAVED_PROMPTS,t))}static async searchPrompts(e){const t=await this.getAllPrompts(),r=e.toLowerCase();return t.filter(e=>e.prompt.toLowerCase().includes(r)||e.command&&e.command.toLowerCase().includes(r))}static async exportPrompts(e){const t=await this.getAllPrompts(),r=e?t.filter(t=>e.includes(t.id)):t;return JSON.stringify(r,null,2)}static async importPrompts(e,t=!1){const r=JSON.parse(e),n=t?[]:await this.getAllPrompts(),a=r.map(e=>({...e,id:`prompt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,createdAt:Date.now(),usageCount:0,lastUsedAt:void 0})),o=[...n,...a].filter(e=>e.command).map(e=>e.command),s=new Set(o);if(o.length!==s.size)throw new Error("Import contains duplicate command shortcuts");const i=[...n,...a];return await C(I.SAVED_PROMPTS,i),a.length}static async updateAlarmForPrompt(e){const t=e.id;if(await chrome.alarms.clear(t),!e.repeatType||"none"===e.repeatType||!e.specificTime)return;const r=new Date,[n,a]=e.specificTime.split(":").map(Number);switch(e.repeatType){case"once":{if(!e.specificDate)return;const[o,s,i]=e.specificDate.split("-").map(Number),c=new Date(o,s-1,i,n,a,0,0);c>r&&await chrome.alarms.create(t,{when:c.getTime()});break}case"daily":{const e=new Date;e.setHours(n,a,0,0),e<=r&&e.setDate(e.getDate()+1),await chrome.alarms.create(t,{when:e.getTime(),periodInMinutes:1440});break}case"weekly":{if(void 0===e.dayOfWeek)return;let o=(e.dayOfWeek-r.getDay()+7)%7;if(0===o){const e=new Date;e.setHours(n,a,0,0),e<=r&&(o=7)}const s=new Date;s.setDate(r.getDate()+o),s.setHours(n,a,0,0),await chrome.alarms.create(t,{when:s.getTime(),periodInMinutes:10080});break}case"monthly":{if(!e.dayOfMonth)return;const o=new Date;o.setDate(e.dayOfMonth),o.setHours(n,a,0,0),o<=r&&o.setMonth(o.getMonth()+1),await chrome.alarms.create(t,{when:o.getTime()});break}case"annually":{if(!e.monthAndDay)return;const[o,s]=e.monthAndDay.split("-").map(Number),i=new Date;i.setMonth(o-1),i.setDate(s),i.setHours(n,a,0,0),i<=r&&i.setFullYear(i.getFullYear()+1),await chrome.alarms.create(t,{when:i.getTime()});break}}}static async updateNextRunTimes(){const e=await this.getAllPrompts(),t=await chrome.alarms.getAll();let r=!1;for(const n of e)if(n.repeatType&&"none"!==n.repeatType){const e=t.find(e=>e.name===n.id),a=e?.scheduledTime;n.nextRun!==a&&(n.nextRun=a,r=!0)}else n.nextRun&&(n.nextRun=void 0,r=!0);r&&await C(I.SAVED_PROMPTS,e)}}const me=Object.freeze(Object.defineProperty({__proto__:null,SavedPromptsService:ye},Symbol.toStringTag,{value:"Module"}));var Ee=(e=>(e.NAVIGATE="navigate",e.READ_PAGE_CONTENT="read_page_content",e.READ_CONSOLE_MESSAGES="read_console_messages",e.READ_NETWORK_REQUESTS="read_network_requests",e.CLICK="click",e.TYPE="type",e.UPLOAD_IMAGE="upload_image",e.DOMAIN_TRANSITION="domain_transition",e.PLAN_APPROVAL="plan_approval",e.EXECUTE_JAVASCRIPT="execute_javascript",e.REMOTE_MCP="remote_mcp",e))(Ee||{});const _e=async()=>{let e=await D(I.ANONYMOUS_ID);return e||(e=crypto.randomUUID(),await C(I.ANONYMOUS_ID,e)),e},we=e=>({email:e.account.email,organizationID:e.organization.uuid,organizationUUID:e.organization.uuid,applicationSlug:"claude-browser-use",isMax:e.account.has_claude_max,isPro:e.account.has_claude_pro,orgType:e.organization.organization_type});var ge=(e=>(e.ALLOW="allow",e.DENY="deny",e))(ge||{}),Se=(e=>(e.ONCE="once",e.ALWAYS="always",e))(Se||{});function Te(e){return{[Ee.NAVIGATE]:"navigate to",[Ee.READ_PAGE_CONTENT]:"read page content on",[Ee.READ_CONSOLE_MESSAGES]:"read debugging information on",[Ee.READ_NETWORK_REQUESTS]:"read debugging information on",[Ee.CLICK]:"click on",[Ee.TYPE]:"type text into",[Ee.UPLOAD_IMAGE]:"upload an image to",[Ee.DOMAIN_TRANSITION]:"navigate from",[Ee.PLAN_APPROVAL]:"approve plan for",[Ee.EXECUTE_JAVASCRIPT]:"execute JavaScript on",[Ee.REMOTE_MCP]:"access"}[e]}const be=["follow_a_plan","skip_all_permission_checks"],Ae="follow_a_plan";export{le as A,he as B,ie as C,Ae as D,ce as E,X as F,ee as G,K as H,V as I,B as J,we as K,ge as L,n as M,me as N,Se as P,E as R,I as S,Ee as T,be as U,re as _,r as a,ye as b,y as c,_e as d,J as e,Z as f,D as g,P as h,Te as i,f as j,$ as k,F as l,Y as m,N as n,G as o,t as p,c as q,m as r,C as s,k as t,Q as u,_ as v,oe as w,se as x,ue as y,ae as z};
