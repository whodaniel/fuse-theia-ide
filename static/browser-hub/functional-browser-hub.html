<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TNF Browser Hub - Comprehensive Chrome-Compatible Browser</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1a1d29;
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: #252836;
            border-right: 1px solid #2d3142;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            transition: width 0.3s ease;
        }

        .sidebar.collapsed {
            width: 60px;
        }

        .sidebar.collapsed .logo-text,
        .sidebar.collapsed .nav-section-title,
        .sidebar.collapsed .nav-item span {
            display: none;
        }

        .sidebar.collapsed .nav-section-header {
            padding: 8px 12px;
        }

        .sidebar.collapsed .nav-item {
            padding: 12px;
            justify-content: center;
        }

        .sidebar.collapsed .sidebar-toggle {
            margin-left: auto;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #2d3142;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
        }

        .logo i {
            font-size: 20px;
            color: #4f46e5;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .sidebar-toggle:hover {
            background: #2d3142;
            color: #ffffff;
        }

        .nav-section {
            padding: 8px 0;
        }

        .nav-section-header {
            padding: 8px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            margin: 0 8px;
        }

        .nav-section-header:hover {
            background: #2d3142;
        }

        .nav-section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .section-arrow {
            font-size: 10px;
            transition: transform 0.2s ease;
        }

        .section-arrow.collapsed {
            transform: rotate(-90deg);
        }

        .nav-section-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .nav-section-content.collapsed {
            max-height: 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #9ca3af;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            position: relative;
            cursor: pointer;
        }

        .nav-item:hover {
            background: #2d3142;
            color: #ffffff;
        }

        .nav-item.active {
            background: #4f46e5;
            color: #ffffff;
        }

        .nav-item i {
            width: 16px;
            text-align: center;
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            margin-left: auto;
        }

        .status-dot.online { background: #10b981; }
        .status-dot.warning { background: #f59e0b; }
        .status-dot.offline { background: #ef4444; }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1a1d29;
        }

        /* Browser Tab Bar */
        .tab-bar {
            background: #252836;
            border-bottom: 1px solid #2d3142;
            display: flex;
            align-items: center;
            padding: 0 12px;
            min-height: 40px;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-app-region: drag;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tab-bar::-webkit-scrollbar {
            display: none;
        }

        .tab-bar * {
            -webkit-app-region: no-drag;
        }

        .tabs-container {
            display: flex;
            align-items: center;
            flex-shrink: 0;
            gap: 4px;
        }

        .tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #2d3142;
            border: 1px solid #374151;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            min-width: 160px;
            max-width: 200px;
            width: 180px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            flex-shrink: 0;
        }

        .tab.active {
            background: #1a1d29;
            border-color: #4f46e5;
        }

        .tab-favicon {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            background: #4f46e5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .tab-title {
            flex: 1;
            font-size: 13px;
            color: #ffffff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tab-close {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .tab-close:hover {
            background: #ef4444;
            color: #ffffff;
        }

        .new-tab-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            margin-left: 8px;
            transition: all 0.2s ease;
        }

        .new-tab-btn:hover {
            background: #2d3142;
            color: #ffffff;
        }

        /* Address Bar */
        .address-bar {
            background: #252836;
            border-bottom: 1px solid #2d3142;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-controls {
            display: flex;
            gap: 8px;
        }

        .nav-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #374151;
            color: #9ca3af;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .nav-btn:hover {
            background: #4b5563;
            color: #ffffff;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .address-input {
            flex: 1;
            background: #1a1d29;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 8px 16px;
            color: #ffffff;
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
        }

        .address-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .reload-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: #374151;
            color: #9ca3af;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .reload-btn:hover {
            background: #4b5563;
            color: #ffffff;
        }

        /* Service Toolbar */
        .service-toolbar {
            background: #252836;
            border-bottom: 1px solid #2d3142;
            padding: 8px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
            font-size: 12px;
        }

        .service-group {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .service-group-label {
            font-weight: 600;
            color: #9ca3af;
            margin-right: 4px;
        }

        .service-chip {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 2px 6px;
            background: #374151;
            border-radius: 4px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .service-chip:hover {
            background: #4b5563;
        }

        .service-chip.active {
            background: #10b981;
        }

        .service-chip.warning {
            background: #f59e0b;
        }

        .service-chip.error {
            background: #ef4444;
        }

        .service-details {
            width: 100%;
            max-height: 100px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            margin-top: 8px;
        }

        .service-details.collapsed {
            max-height: 0;
            margin-top: 0;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .content-main {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        /* Terminal Section */
        .terminal-section {
            height: 200px;
            min-height: 150px;
            max-height: 400px;
            border-top: 1px solid #2d3142;
            background: #252836;
            display: none;
            flex-direction: column;
            resize: vertical;
            overflow: hidden;
        }
        
        .terminal-section.visible {
            display: flex;
        }
        
        .terminal-header {
            background: #2d3142;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid #374151;
        }
        
        .terminal-title {
            color: #ffffff;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .terminal-controls {
            display: flex;
            gap: 8px;
        }
        
        .terminal-btn {
            background: none;
            border: none;
            color: #9ca3af;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .terminal-btn:hover {
            background: #374151;
            color: #ffffff;
        }
        
        .terminal-content {
            flex: 1;
            background: #1a1d29;
            overflow: hidden;
        }
        
        .terminal-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #0f0f23;
        }
        
        .terminal-fallback {
            padding: 20px;
            text-align: center;
            color: #9ca3af;
            font-size: 14px;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* Add Sidebar Menu Items */
        .add-menu-item {
            padding: 8px 20px;
            margin: 0 8px;
            border: 1px dashed #374151;
            border-radius: 4px;
            color: #9ca3af;
            cursor: pointer;
            font-size: 12px;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        .add-menu-item:hover {
            border-color: #4f46e5;
            color: #4f46e5;
            background: rgba(79, 70, 229, 0.1);
        }
        
        /* Prompt Management */
        .prompt-manager {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-height: 500px;
            background: #252836;
            border: 1px solid #374151;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none;
        }
        
        .prompt-manager.visible {
            display: flex;
            flex-direction: column;
        }
        
        .prompt-manager-header {
            padding: 20px;
            border-bottom: 1px solid #374151;
            display: flex;
            align-items: center;
            justify-content: between;
        }
        
        .prompt-manager-title {
            font-size: 18px;
            font-weight: 600;
            color: #ffffff;
        }
        
        .prompt-manager-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .prompt-template {
            background: #1a1d29;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .prompt-template:hover {
            border-color: #4f46e5;
        }
        
        .prompt-template-name {
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 4px;
        }
        
        .prompt-template-description {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 8px;
        }
        
        .prompt-template-tags {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        
        .prompt-tag {
            background: #374151;
            color: #9ca3af;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
        }
        
        /* Folder and Drag-Drop Support */
        .prompt-folder {
            background: #2d3142;
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .prompt-folder:hover {
            border-color: #4f46e5;
        }
        
        .prompt-folder-header {
            display: flex;
            align-items: center;
            justify-content: between;
            margin-bottom: 8px;
        }
        
        .prompt-folder-name {
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .prompt-folder-toggle {
            margin-left: auto;
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .prompt-folder-toggle.collapsed {
            transform: rotate(-90deg);
        }
        
        .prompt-folder-content {
            max-height: 300px;
            overflow: hidden;
            transition: max-height 0.3s ease;
            padding-left: 20px;
        }
        
        .prompt-folder-content.collapsed {
            max-height: 0;
        }
        
        .prompt-template.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .prompt-folder.drag-over {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .prompt-template.in-folder {
            margin-left: 0;
            margin-bottom: 8px;
        }
        
        .prompt-actions {
            display: flex;
            gap: 4px;
            margin-left: auto;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .prompt-template:hover .prompt-actions {
            opacity: 1;
        }
        
        .prompt-action-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
            font-size: 12px;
            transition: all 0.2s ease;
        }
        
        .prompt-action-btn:hover {
            background: #374151;
            color: #ffffff;
        }

        .tab-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #1a1d29;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .browser-frame {
            width: 100%;
            height: 100%;
            border: none;
            background: #ffffff;
        }

        /* Dashboard Content */
        .dashboard-content {
            padding: 24px;
            overflow-y: auto;
            height: 100%;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background: #252836;
            border: 1px solid #2d3142;
            border-radius: 12px;
            padding: 24px;
            transition: all 0.2s ease;
        }

        .card:hover {
            border-color: #4f46e5;
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .card-title i {
            color: #4f46e5;
        }

        .card-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .stat-label {
            color: #9ca3af;
        }

        .stat-value {
            color: #ffffff;
            font-weight: 500;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: #4f46e5;
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #4338ca;
        }

        .btn-secondary {
            background: #374151;
            color: #ffffff;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #10b981;
            color: #ffffff;
        }

        .btn-success:hover {
            background: #059669;
        }

        /* Welcome Banner */
        .welcome-banner {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            border-radius: 12px;
            padding: 32px;
            text-align: center;
            margin-bottom: 32px;
        }

        .welcome-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .welcome-subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 24px;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #374151;
            border-radius: 50%;
            border-top-color: #4f46e5;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Zoom Support */
        .app-container {
            zoom: var(--zoom-level, 1);
            transform-origin: top left;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 240px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Keyboard shortcuts info */
        .zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 1000;
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            background: #374151;
            border: none;
            border-radius: 6px;
            color: #ffffff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: #4b5563;
        }
    </style>
</head><bo
dy>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-rocket"></i>
                    <span class="logo-text">TNF Browser Hub</span>
                </div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('dashboard-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="dashboard-section-arrow"></i>
                        Dashboard
                    </div>
                </div>
                <div class="nav-section-content" id="dashboard-section">
                    <div class="nav-item active" onclick="switchToTab('dashboard')">
                        <i class="fas fa-chart-bar"></i>
                        <span>Home</span>
                        <div class="status-dot online"></div>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('ai-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="ai-section-arrow"></i>
                        AI Services
                    </div>
                </div>
                <div class="nav-section-content" id="ai-section">
                    <div class="nav-item" onclick="openService('claude')">
                        <i class="fas fa-star"></i>
                        <span>Claude AI</span>
                        <div class="status-dot online"></div>
                    </div>
                    <div class="nav-item" onclick="openService('gemini')">
                        <i class="fas fa-gem"></i>
                        <span>Gemini</span>
                        <div class="status-dot online"></div>
                    </div>
                    <div class="nav-item" onclick="openService('chatgpt')">
                        <i class="fas fa-comments"></i>
                        <span>ChatGPT</span>
                        <div class="status-dot warning"></div>
                    </div>
                    <div class="nav-item" onclick="openService('perplexity')">
                        <i class="fas fa-search"></i>
                        <span>Perplexity</span>
                        <div class="status-dot online"></div>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('dev-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="dev-section-arrow"></i>
                        Development
                    </div>
                </div>
                <div class="nav-section-content" id="dev-section">
                    <div class="nav-item" onclick="openService('skideancer')">
                        <i class="fas fa-laptop-code"></i>
                        <span>SkIDEancer</span>
                        <div class="status-dot warning"></div>
                    </div>
                    <div class="nav-item" onclick="openService('vscode')">
                        <i class="fas fa-file-code"></i>
                        <span>VS Code</span>
                        <div class="status-dot offline"></div>
                    </div>
                    <div class="nav-item" onclick="openService('github')">
                        <i class="fab fa-github"></i>
                        <span>GitHub</span>
                        <div class="status-dot online"></div>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('tnf-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="tnf-section-arrow"></i>
                        TNF Core
                    </div>
                </div>
                <div class="nav-section-content" id="tnf-section">
                    <div class="nav-item" onclick="openService('agents')">
                        <i class="fas fa-robot"></i>
                        <span>Agents</span>
                        <div class="status-dot online"></div>
                    </div>
                    <div class="nav-item" onclick="openService('workflows')">
                        <i class="fas fa-project-diagram"></i>
                        <span>Workflows</span>
                        <div class="status-dot online"></div>
                    </div>
                    <div class="nav-item" onclick="openService('analytics')">
                        <i class="fas fa-chart-bar"></i>
                        <span>Analytics</span>
                        <div class="status-dot online"></div>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('auto-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="auto-section-arrow"></i>
                        Automation
                    </div>
                </div>
                <div class="nav-section-content collapsed" id="auto-section">
                    <div class="nav-item" onclick="openService('browser-use')">
                        <i class="fas fa-globe"></i>
                        <span>Browser Use</span>
                        <div class="status-dot offline"></div>
                    </div>
                    <div class="nav-item" onclick="openService('screenshot')">
                        <i class="fas fa-camera"></i>
                        <span>Screenshot</span>
                        <div class="status-dot offline"></div>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('tools-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="tools-section-arrow"></i>
                        Developer Tools
                    </div>
                </div>
                <div class="nav-section-content" id="tools-section">
                    <div class="nav-item" onclick="toggleTerminal()">
                        <i class="fas fa-terminal"></i>
                        <span>Terminal</span>
                        <div class="status-dot online"></div>
                    </div>
                    <div class="nav-item" onclick="openPromptManager()">
                        <i class="fas fa-file-alt"></i>
                        <span>Prompt Templates</span>
                        <div class="status-dot online"></div>
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('custom-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="custom-section-arrow"></i>
                        Custom Links
                    </div>
                </div>
                <div class="nav-section-content" id="custom-section">
                    <div class="add-menu-item" onclick="addCustomMenuItem()">
                        <i class="fas fa-plus"></i>
                        Add Custom Link
                    </div>
                </div>
            </div>

            <div class="nav-section">
                <div class="nav-section-header" onclick="toggleSection('account-section')">
                    <div class="nav-section-title">
                        <i class="fas fa-chevron-down section-arrow" id="account-section-arrow"></i>
                        Account
                    </div>
                </div>
                <div class="nav-section-content" id="account-section">
                    <div class="nav-item" onclick="openAccount()">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                        <div class="status-dot online"></div>
                    </div>
                    <div class="nav-item" onclick="openSettings()">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                        <div class="status-dot online"></div>
                    </div>
                    <div class="nav-item" onclick="openSignIn()">
                        <i class="fas fa-sign-in-alt"></i>
                        <span>Sign In</span>
                        <div class="status-dot warning"></div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Browser Tab Bar -->
            <div class="tab-bar" id="tabBar">
                <div class="tabs-container" id="tabsContainer">
                    <div class="tab active" data-tab-id="dashboard">
                        <div class="tab-favicon">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div class="tab-title">TNF Dashboard</div>
                        <button class="tab-close" onclick="event.stopPropagation(); closeTab('dashboard')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <button class="new-tab-btn" onclick="createNewTab()">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <!-- Address Bar -->
            <div class="address-bar">
                <div class="nav-controls">
                    <button class="nav-btn" id="backBtn" onclick="navigateBack()" disabled>
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button class="nav-btn" id="forwardBtn" onclick="navigateForward()" disabled>
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <input type="text" class="address-input" id="addressInput" placeholder="Enter URL or search..." onkeypress="handleAddressInput(event)">
                <button class="reload-btn" onclick="reloadCurrentTab()">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>

            <!-- Service Toolbar -->
            <div class="service-toolbar">
                <div class="service-group">
                    <span class="service-group-label">System:</span>
                    <div class="service-chip error" id="serviceStatus">‚óè 0/4</div>
                    <button class="service-chip" onclick="toggleServiceDetails()" id="serviceToggle">
                        <i class="fas fa-chevron-down"></i>
                        Details
                    </button>
                    <button class="btn btn-secondary" style="margin-left: 8px;" onclick="refreshServices()">
                        <i class="fas fa-sync"></i>
                    </button>
                </div>
                <div class="service-details collapsed" id="serviceDetails">
                    <div class="service-group">
                        <div class="service-chip error" id="frontendStatus">‚óè Frontend</div>
                        <div class="service-chip error" id="gatewayStatus">‚óè API Gateway</div>
                        <div class="service-chip warning" id="skideancerStatus">‚óè SkIDEancer</div>
                        <div class="service-chip error" id="mlStatus">‚óè ML Service</div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Main Content Area -->
                <div class="content-main">
                    <!-- Dashboard Tab Content -->
                    <div class="tab-content active" id="tab-dashboard">
                        <div class="dashboard-content">
                            <!-- Welcome Banner -->
                            <div class="welcome-banner">
                                <h1 class="welcome-title">üöÄ TNF Browser Hub</h1>
                                <p class="welcome-subtitle">Comprehensive Chrome-Compatible Browser</p>
                                <p>Create a new tab or select a service to get started</p>
                            </div>

                            <!-- Dashboard Grid -->
                            <div class="dashboard-grid" id="dashboardGrid">
                                <!-- Content will be loaded dynamically -->
                            </div>

                            <!-- Status Footer -->
                            <div style="text-align: center; padding: 20px; color: #6b7280; font-size: 14px;">
                                <span id="connectionStatus">Connecting to services...</span>
                                <span style="margin-left: 20px;" id="tabCount">1 tab</span>
                                <span style="margin-left: 20px;" id="memoryUsage">Memory: 0 MB</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Terminal Section -->
                <div class="terminal-section" id="terminalSection">
                    <div class="terminal-header">
                        <div class="terminal-title">
                            <i class="fas fa-terminal"></i>
                            Terminal (pnpm run dev)
                        </div>
                        <div class="terminal-controls">
                            <button class="terminal-btn" onclick="clearTerminal()" title="Clear">
                                <i class="fas fa-eraser"></i>
                            </button>
                            <button class="terminal-btn" onclick="toggleTerminalSize()" title="Resize">
                                <i class="fas fa-expand-arrows-alt"></i>
                            </button>
                            <button class="terminal-btn" onclick="hideTerminal()" title="Hide">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="terminal-content" id="terminalContent">
                        <!-- Terminal content will be loaded here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Zoom Controls -->
    <div class="zoom-controls">
        <button class="zoom-btn" onclick="adjustZoom(-0.1)" title="Zoom Out (Ctrl+-)">
            <i class="fas fa-minus"></i>
        </button>
        <button class="zoom-btn" onclick="resetZoom()" title="Reset Zoom (Ctrl+0)">
            <i class="fas fa-expand-arrows-alt"></i>
        </button>
        <button class="zoom-btn" onclick="adjustZoom(0.1)" title="Zoom In (Ctrl++)">
            <i class="fas fa-plus"></i>
        </button>
    </div>

    <!-- Prompt Manager Modal -->
    <div class="prompt-manager" id="promptManager">
        <div class="prompt-manager-header">
            <div class="prompt-manager-title">
                <i class="fas fa-file-alt"></i>
                Prompt Templates
            </div>
            <div style="display: flex; gap: 8px; margin-left: auto;">
                <button class="terminal-btn" onclick="showNewPromptForm()" title="Create New Prompt">
                    <i class="fas fa-plus"></i>
                </button>
                <button class="terminal-btn" onclick="showNewFolderForm()" title="Create New Folder">
                    <i class="fas fa-folder-plus"></i>
                </button>
                <button class="terminal-btn" onclick="closePromptManager()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="prompt-manager-body" id="promptManagerBody">
            <!-- Templates will be loaded here -->
        </div>
    </div>

    <!-- New Prompt Form Modal -->
    <div class="prompt-manager" id="newPromptModal" style="display: none;">
        <div class="prompt-manager-header">
            <div class="prompt-manager-title">
                <i class="fas fa-plus"></i>
                Create New Prompt Template
            </div>
            <button class="terminal-btn" onclick="closeNewPromptModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="prompt-manager-body">
            <form id="newPromptForm" style="display: flex; flex-direction: column; gap: 16px;">
                <div>
                    <label style="display: block; margin-bottom: 4px; color: #ffffff; font-weight: 500;">Name</label>
                    <input type="text" id="promptName" required style="width: 100%; padding: 8px; border: 1px solid #374151; border-radius: 4px; background: #1a1d29; color: #ffffff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 4px; color: #ffffff; font-weight: 500;">Description</label>
                    <input type="text" id="promptDescription" style="width: 100%; padding: 8px; border: 1px solid #374151; border-radius: 4px; background: #1a1d29; color: #ffffff;">
                </div>
                <div>
                    <label style="display: block; margin-bottom: 4px; color: #ffffff; font-weight: 500;">Category</label>
                    <select id="promptCategory" style="width: 100%; padding: 8px; border: 1px solid #374151; border-radius: 4px; background: #1a1d29; color: #ffffff;">
                        <option value="general">General</option>
                        <option value="agent">Agent</option>
                        <option value="development">Development</option>
                        <option value="debugging">Debugging</option>
                        <option value="workflow">Workflow</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 4px; color: #ffffff; font-weight: 500;">Template Content</label>
                    <textarea id="promptTemplate" rows="6" required style="width: 100%; padding: 8px; border: 1px solid #374151; border-radius: 4px; background: #1a1d29; color: #ffffff; resize: vertical;" placeholder="Enter your prompt template. Use {{variable}} for placeholders."></textarea>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 4px; color: #ffffff; font-weight: 500;">Tags (comma-separated)</label>
                    <input type="text" id="promptTags" style="width: 100%; padding: 8px; border: 1px solid #374151; border-radius: 4px; background: #1a1d29; color: #ffffff;" placeholder="tag1, tag2, tag3">
                </div>
                <div style="display: flex; gap: 8px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeNewPromptModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Prompt</button>
                </div>
            </form>
        </div>
    </div>
  <script>
        // Global state
        let tabs = new Map();
        let activeTabId = 'dashboard';
        let tabCounter = 1;
        let services = new Map();
        let serviceStatus = {
            frontend: false,
            gateway: false,
            skideancer: false,
            ml: false
        };

        // API Configuration
        const API_BASE = 'http://localhost:3005/v1'; // API Gateway
        const SKIDEANCER_URL = 'http://localhost:3007';
        const FRONTEND_URL = 'http://localhost:3000';

        // Initialize the browser hub
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ TNF Browser Hub initializing...');
            
            // Initialize default dashboard tab
            tabs.set('dashboard', {
                id: 'dashboard',
                title: 'TNF Dashboard',
                url: 'dashboard://home',
                type: 'dashboard',
                favicon: 'fas fa-chart-bar',
                history: ['dashboard://home'],
                historyIndex: 0
            });

            // Load dashboard content
            loadDashboardContent();
            
            // Check service status
            checkServiceStatus();
            
            // Update address bar
            updateAddressBar();
            
            // Initialize sections
            initializeSections();

            // Start periodic service checks
            setInterval(checkServiceStatus, 10000); // Check every 10 seconds
            
            // Also check when window gains focus (user might have started services)
            window.addEventListener('focus', () => {
                setTimeout(checkServiceStatus, 1000);
            });
            
            // Show initial service status
            setTimeout(() => {
                showServiceStatusNotification();
            }, 3000);
        });

        // Tab Management
        function createNewTab(url = 'about:blank', title = 'New Tab') {
            const tabId = `tab-${++tabCounter}`;
            
            const tab = {
                id: tabId,
                title: title,
                url: url,
                type: url.startsWith('http') ? 'web' : 'internal',
                favicon: getFaviconForUrl(url),
                history: [url],
                historyIndex: 0
            };

            tabs.set(tabId, tab);
            
            // Create tab element
            const tabElement = document.createElement('div');
            tabElement.className = 'tab';
            tabElement.setAttribute('data-tab-id', tabId);
            tabElement.innerHTML = `
                <div class="tab-favicon">
                    <i class="${tab.favicon}"></i>
                </div>
                <div class="tab-title">${tab.title}</div>
                <button class="tab-close" onclick="event.stopPropagation(); closeTab('${tabId}')">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add click handler to tab element
            tabElement.addEventListener('click', () => switchToTab(tabId));
            
            // Insert into tabs container
            const tabsContainer = document.getElementById('tabsContainer');
            if (tabsContainer) {
                tabsContainer.appendChild(tabElement);
            }
            
            // Create tab content
            const contentElement = document.createElement('div');
            contentElement.className = 'tab-content';
            contentElement.id = `tab-${tabId}`;
            
            if (tab.type === 'web') {
                // Show loading state first
                contentElement.innerHTML = `
                    <div class="loading-container" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #1a1d29;">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 16px; color: #9ca3af;">Loading ${new URL(url).hostname}...</p>
                        <p style="margin-top: 8px; font-size: 12px; color: #6b7280;">If this takes too long, the service may be offline</p>
                    </div>
                `;
                
                // Create iframe after a short delay to show loading state
                setTimeout(() => {
                    const iframe = document.createElement('iframe');
                    iframe.className = 'browser-frame';
                    iframe.src = url;
                    iframe.frameBorder = '0';
                    iframe.allowFullscreen = true;
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    iframe.style.border = 'none';
                    iframe.style.background = '#ffffff';
                    
                    let loadTimeout;
                    let hasLoaded = false;
                    
                    // Set a timeout for loading
                    loadTimeout = setTimeout(() => {
                        if (!hasLoaded) {
                            contentElement.innerHTML = `
                                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #1a1d29; color: #f59e0b; text-align: center; padding: 40px;">
                                    <i class="fas fa-clock" style="font-size: 48px; margin-bottom: 16px;"></i>
                                    <h3 style="color: #ffffff; margin-bottom: 8px;">Loading Timeout</h3>
                                    <p style="color: #9ca3af; margin-bottom: 8px;">The service is taking longer than expected to load</p>
                                    <p style="color: #6b7280; font-size: 14px; margin-bottom: 24px;">This usually means the service is starting up or offline</p>
                                    
                                    <div style="display: flex; gap: 12px;">
                                        <button class="btn btn-primary" onclick="reloadCurrentTab()">
                                            <i class="fas fa-sync"></i> Retry
                                        </button>
                                        <button class="btn btn-secondary" onclick="openService('dashboard')">
                                            <i class="fas fa-home"></i> Go to Dashboard
                                        </button>
                                    </div>
                                </div>
                            `;
                        }
                    }, 10000); // 10 second timeout
                    
                    // Handle iframe load events
                    iframe.onload = () => {
                        hasLoaded = true;
                        clearTimeout(loadTimeout);
                        
                        try {
                            const title = iframe.contentDocument?.title || new URL(url).hostname;
                            updateTabTitle(tabId, title);
                        } catch (e) {
                            updateTabTitle(tabId, new URL(url).hostname);
                        }
                    };
                    
                    // Handle iframe errors
                    iframe.onerror = () => {
                        hasLoaded = true;
                        clearTimeout(loadTimeout);
                        
                        contentElement.innerHTML = `
                            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #1a1d29; color: #ef4444; text-align: center; padding: 40px;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 48px; margin-bottom: 16px;"></i>
                                <h3 style="color: #ffffff; margin-bottom: 8px;">Connection Failed</h3>
                                <p style="color: #9ca3af; margin-bottom: 8px;">Could not connect to ${new URL(url).hostname}</p>
                                <p style="color: #6b7280; font-size: 14px; margin-bottom: 24px;">The service may be offline or unreachable</p>
                                
                                <div style="display: flex; gap: 12px;">
                                    <button class="btn btn-primary" onclick="reloadCurrentTab()">
                                        <i class="fas fa-sync"></i> Retry
                                    </button>
                                    <button class="btn btn-secondary" onclick="checkServiceStatus()">
                                        <i class="fas fa-heartbeat"></i> Check Services
                                    </button>
                                </div>
                            </div>
                        `;
                    };
                    
                    contentElement.innerHTML = '';
                    contentElement.appendChild(iframe);
                }, 500);
            } else {
                contentElement.innerHTML = `<div class="dashboard-content"><div class="loading-spinner"></div><p style="margin-top: 16px; text-align: center;">Loading...</p></div>`;
            }
            
            const contentArea = document.querySelector('.content-area');
            if (contentArea) {
                contentArea.appendChild(contentElement);
            }
            
            // Switch to new tab
            switchToTab(tabId);
            
            updateTabCount();
            return tabId;
        }

        function getFaviconForUrl(url) {
            if (url.includes('claude.ai')) return 'fas fa-star';
            if (url.includes('gemini.google.com')) return 'fas fa-gem';
            if (url.includes('chat.openai.com')) return 'fas fa-comments';
            if (url.includes('perplexity.ai')) return 'fas fa-search';
            if (url.includes('github.com')) return 'fab fa-github';
            if (url.includes('vscode.dev')) return 'fas fa-file-code';
            if (url.includes('localhost:3007')) return 'fas fa-laptop-code';
            if (url.includes('localhost:3000')) return 'fas fa-chart-line';
            return 'fas fa-globe';
        }

        function switchToTab(tabId) {
            // Remove active class from all tabs and nav items
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            // Add active class to selected tab
            const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
            let contentElement = document.getElementById(`tab-${tabId}`);
            
            // Handle dashboard tab specially
            if (tabId === 'dashboard') {
                contentElement = document.getElementById('tab-dashboard');
                // Mark dashboard nav item as active
                document.querySelector('.nav-item[onclick*="dashboard"]')?.classList.add('active');
            }
            
            if (tabElement && contentElement) {
                tabElement.classList.add('active');
                contentElement.classList.add('active');
                activeTabId = tabId;
                updateAddressBar();
                updateNavigationButtons();
            }
        }

        function closeTab(tabId) {
            if (tabs.size <= 1) {
                showNotification('Cannot close the last tab', 'warning');
                return;
            }
            
            // Remove tab and content
            const tabElement = document.querySelector(`[data-tab-id="${tabId}"]`);
            const contentElement = document.getElementById(`tab-${tabId}`);
            
            if (tabElement) tabElement.remove();
            if (contentElement) contentElement.remove();
            
            tabs.delete(tabId);
            
            // If closing active tab, switch to another tab
            if (activeTabId === tabId) {
                const remainingTabs = Array.from(tabs.keys());
                if (remainingTabs.length > 0) {
                    switchToTab(remainingTabs[0]);
                }
            }
            
            updateTabCount();
        }

        // Navigation
        function navigateBack() {
            const tab = tabs.get(activeTabId);
            if (tab && tab.historyIndex > 0) {
                tab.historyIndex--;
                const url = tab.history[tab.historyIndex];
                loadTabContent(activeTabId, url);
                updateNavigationButtons();
            }
        }

        function navigateForward() {
            const tab = tabs.get(activeTabId);
            if (tab && tab.historyIndex < tab.history.length - 1) {
                tab.historyIndex++;
                const url = tab.history[tab.historyIndex];
                loadTabContent(activeTabId, url);
                updateNavigationButtons();
            }
        }

        function reloadCurrentTab() {
            const tab = tabs.get(activeTabId);
            if (tab) {
                loadTabContent(activeTabId, tab.url);
            }
        }

        function handleAddressInput(event) {
            if (event.key === 'Enter') {
                const url = event.target.value.trim();
                if (url) {
                    navigateToUrl(url);
                }
            }
        }

        function navigateToUrl(url) {
            // Add protocol if missing
            if (!url.startsWith('http://') && !url.startsWith('https://') && !url.includes('://')) {
                if (url.includes('.') && !url.includes(' ')) {
                    url = 'https://' + url;
                } else {
                    url = 'https://www.google.com/search?q=' + encodeURIComponent(url);
                }
            }
            
            const tab = tabs.get(activeTabId);
            if (tab) {
                // Add to history
                tab.history = tab.history.slice(0, tab.historyIndex + 1);
                tab.history.push(url);
                tab.historyIndex = tab.history.length - 1;
                
                loadTabContent(activeTabId, url);
                updateNavigationButtons();
            }
        }

        function loadTabContent(tabId, url) {
            const tab = tabs.get(tabId);
            const contentElement = document.getElementById(`tab-${tabId}`);
            
            if (!tab || !contentElement) return;
            
            tab.url = url;
            
            if (url.startsWith('dashboard://')) {
                loadDashboardContent();
            } else if (url.startsWith('http')) {
                contentElement.innerHTML = `<iframe class="browser-frame" src="${url}"></iframe>`;
                
                // Update tab title when iframe loads
                const iframe = contentElement.querySelector('iframe');
                iframe.onload = () => {
                    try {
                        const title = iframe.contentDocument?.title || url;
                        updateTabTitle(tabId, title);
                    } catch (e) {
                        updateTabTitle(tabId, new URL(url).hostname);
                    }
                };
            }
            
            updateAddressBar();
        }

        // Service Management
        function openService(serviceName) {
            const serviceUrls = {
                // External AI Services
                'claude': 'https://claude.ai',
                'gemini': 'https://gemini.google.com',
                'chatgpt': 'https://chat.openai.com',
                'perplexity': 'https://perplexity.ai',
                
                // Development Tools
                'skideancer': SKIDEANCER_URL,
                'vscode': 'https://vscode.dev',
                'github': 'https://github.com',
                'terminal': SKIDEANCER_URL + '/#/terminal',
                
                // TNF Services - Direct routes to frontend app
                'dashboard': FRONTEND_URL,
                'agents': FRONTEND_URL + '/agents',
                'workflows': FRONTEND_URL + '/workflows', 
                'analytics': FRONTEND_URL + '/analytics',
                
                // Automation Tools
                'browser-use': FRONTEND_URL + '/#/automation/browser',
                'screenshot': FRONTEND_URL + '/#/automation/screenshot'
            };
            
            const url = serviceUrls[serviceName];
            if (url) {
                const title = getServiceTitle(serviceName);
                
                // Check if service is available before opening
                if (isInternalService(serviceName) && !isServiceOnline(serviceName)) {
                    showServiceOfflineMessage(serviceName, title);
                    return;
                }
                
                createNewTab(url, title);
                
                // Update nav item active state
                document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
                if (event && event.target) {
                    event.target.closest('.nav-item')?.classList.add('active');
                }
            }
        }

        function isInternalService(serviceName) {
            const internalServices = ['dashboard', 'agents', 'workflows', 'analytics', 'browser-use', 'screenshot', 'skideancer'];
            return internalServices.includes(serviceName);
        }

        function isServiceOnline(serviceName) {
            const serviceMapping = {
                'dashboard': 'frontend',
                'agents': 'frontend', 
                'workflows': 'frontend',
                'analytics': 'frontend',
                'browser-use': 'frontend',
                'screenshot': 'frontend',
                'skideancer': 'skideancer'
            };
            
            const serviceKey = serviceMapping[serviceName];
            return serviceStatus[serviceKey] === true;
        }

        function showServiceOfflineMessage(serviceName, title) {
            const tabId = createNewTab('about:blank', title);
            const contentElement = document.getElementById(`tab-${tabId}`);
            
            if (contentElement) {
                contentElement.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; background: #1a1d29; color: #ffffff; text-align: center; padding: 40px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 64px; color: #f59e0b; margin-bottom: 24px;"></i>
                        <h2 style="margin-bottom: 16px; color: #ffffff;">Service Offline</h2>
                        <p style="margin-bottom: 8px; color: #9ca3af; font-size: 16px;">${title} is currently offline</p>
                        <p style="margin-bottom: 24px; color: #6b7280; font-size: 14px;">Start the development servers to access this service</p>
                        
                        <div style="background: #252836; padding: 20px; border-radius: 8px; margin-bottom: 24px; text-align: left;">
                            <p style="color: #9ca3af; margin-bottom: 8px; font-size: 14px;">To start services:</p>
                            <code style="background: #1a1d29; padding: 8px 12px; border-radius: 4px; color: #10b981; font-family: monospace;">pnpm run dev</code>
                        </div>
                        
                        <button class="btn btn-primary" onclick="refreshServices()" style="margin-right: 12px;">
                            <i class="fas fa-sync"></i> Check Again
                        </button>
                        <button class="btn btn-secondary" onclick="closeTab('${tabId}')">
                            <i class="fas fa-times"></i> Close Tab
                        </button>
                    </div>
                `;
            }
        }

        function getServiceTitle(serviceName) {
            const titles = {
                'claude': 'Claude AI',
                'gemini': 'Gemini',
                'chatgpt': 'ChatGPT',
                'perplexity': 'Perplexity',
                'skideancer': 'SkIDEancer',
                'vscode': 'VS Code',
                'github': 'GitHub',
                'terminal': 'Terminal',
                'dashboard': 'TNF Dashboard',
                'agents': 'AI Agents',
                'workflows': 'Workflows',
                'analytics': 'Analytics',
                'browser-use': 'Browser Automation',
                'screenshot': 'Screenshot Tool'
            };
            return titles[serviceName] || serviceName.charAt(0).toUpperCase() + serviceName.slice(1);
        }

        // Service Status Checking
        async function checkServiceStatus() {
            const services = [
                { name: 'frontend', url: FRONTEND_URL, healthPath: '/health', port: 3000 },
                { name: 'gateway', url: API_BASE.replace('/v1', ''), healthPath: '/health', port: 3005 },
                { name: 'skideancer', url: SKIDEANCER_URL, healthPath: '/', port: 3007 }, // SkIDEancer doesn't have /health
                { name: 'ml', url: 'http://localhost:3008', healthPath: '/health', port: 3008 }
            ];
            
            let activeCount = 0;
            
            for (const service of services) {
                try {
                    // Use different approach for different services
                    let isOnline = false;
                    
                    if (service.name === 'skideancer') {
                        // For SkIDEancer, just check if the port responds
                        const response = await fetch(service.url, { 
                            method: 'HEAD',
                            mode: 'no-cors',
                            timeout: 3000 
                        });
                        isOnline = true; // If no error thrown, service is up
                    } else {
                        // For other services, check health endpoint
                        const response = await fetch(service.url + service.healthPath, { 
                            method: 'GET',
                            mode: 'no-cors',
                            timeout: 3000 
                        });
                        isOnline = true;
                    }
                    
                    serviceStatus[service.name] = isOnline;
                    if (isOnline) activeCount++;
                } catch (error) {
                    serviceStatus[service.name] = false;
                    console.log(`Service ${service.name} (${service.url}) is offline:`, error.message);
                }
            }
            
            // Update service status display
            updateServiceStatusDisplay(activeCount, services.length);
            
            // Update connection status
            const statusElement = document.getElementById('connectionStatus');
            if (activeCount === 0) {
                statusElement.textContent = 'All services offline - Running in standalone mode';
                statusElement.style.color = '#ef4444';
            } else if (activeCount < services.length) {
                statusElement.textContent = `${activeCount}/${services.length} services online - Partial functionality`;
                statusElement.style.color = '#f59e0b';
            } else {
                statusElement.textContent = 'All systems operational';
                statusElement.style.color = '#10b981';
            }
            
            // Update nav item status dots based on service status
            updateNavItemStatus();
            
            // Show notification if service status changed significantly
            const currentOnlineCount = Object.values(serviceStatus).filter(status => status === true).length;
            if (window.lastOnlineCount !== undefined && currentOnlineCount !== window.lastOnlineCount) {
                if (currentOnlineCount > window.lastOnlineCount) {
                    showTemporaryNotification(`‚úÖ Service came online! (${currentOnlineCount}/${services.length} active)`, 'success');
                } else if (currentOnlineCount < window.lastOnlineCount) {
                    showTemporaryNotification(`‚ö†Ô∏è Service went offline (${currentOnlineCount}/${services.length} active)`, 'warning');
                }
            }
            window.lastOnlineCount = currentOnlineCount;
        }

        function toggleServiceDetails() {
            const details = document.getElementById('serviceDetails');
            const toggle = document.getElementById('serviceToggle');
            
            if (details && toggle) {
                details.classList.toggle('collapsed');
                const icon = toggle.querySelector('i');
                if (icon) {
                    icon.classList.toggle('fa-chevron-down');
                    icon.classList.toggle('fa-chevron-up');
                }
            }
        }

        function updateServiceStatusDisplay(active, total) {
            const statusElement = document.getElementById('serviceStatus');
            statusElement.textContent = `‚óè ${active}/${total}`;
            
            if (active === 0) {
                statusElement.className = 'service-chip error';
            } else if (active < total) {
                statusElement.className = 'service-chip warning';
            } else {
                statusElement.className = 'service-chip active';
            }

            // Update individual service status
            const services = ['frontend', 'gateway', 'skideancer', 'ml'];
            services.forEach(service => {
                const element = document.getElementById(service + 'Status');
                if (element) {
                    const isOnline = serviceStatus[service];
                    element.className = `service-chip ${isOnline ? 'active' : 'error'}`;
                    element.textContent = `‚óè ${service.charAt(0).toUpperCase() + service.slice(1)}`;
                }
            });
        }

        async function refreshServices() {
            const refreshBtn = event?.target;
            let originalText = '';
            
            if (refreshBtn) {
                originalText = refreshBtn.innerHTML;
                refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
                refreshBtn.disabled = true;
            }
            
            await checkServiceStatus();
            
            // Show updated status
            showServiceStatusNotification();
            
            if (refreshBtn) {
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                }, 1000);
            }
        }

        // Dashboard Content Loading
        async function loadDashboardContent() {
            const dashboardGrid = document.getElementById('dashboardGrid');
            if (!dashboardGrid) return;
            
            // Show loading state
            dashboardGrid.innerHTML = '<div style="text-align: center; padding: 40px;"><div class="loading-spinner"></div><p style="margin-top: 16px;">Loading dashboard...</p></div>';
            
            try {
                // Try to load real data from API
                const agentsData = await fetchAgents();
                const systemData = await fetchSystemStatus();
                
                dashboardGrid.innerHTML = generateDashboardCards(agentsData, systemData);
            } catch (error) {
                // Fallback to static content
                dashboardGrid.innerHTML = generateStaticDashboardCards();
            }
        }

        async function fetchAgents() {
            try {
                const response = await fetch(`${API_BASE}/agents`);
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.log('Agents API unavailable, using mock data');
            }
            
            // Mock data
            return {
                active: 12,
                total: 15,
                queue: 3,
                successRate: 97.5
            };
        }

        async function fetchSystemStatus() {
            try {
                const response = await fetch(`${API_BASE.replace('/v1', '')}/health`);
                if (response.ok) {
                    return await response.json();
                }
            } catch (error) {
                console.log('System API unavailable, using mock data');
            }
            
            // Mock data
            return {
                cpu: 45,
                memory: { used: 2.1, total: 8 },
                disk: { used: 156, total: 500 },
                uptime: 3600
            };
        }

        function generateDashboardCards(agentsData, systemData) {
            return `
                <!-- TNF Core Status -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-rocket"></i>
                            TNF Core Status
                        </div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <span class="stat-label">Core Services:</span>
                            <span class="stat-value" style="color: #10b981;">Online</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Agent Orchestrator:</span>
                            <span class="stat-value" style="color: #10b981;">Running</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Workflow Engine:</span>
                            <span class="stat-value" style="color: #f59e0b;">Partial</span>
                        </div>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="btn btn-primary" onclick="restartCore()">
                            <i class="fas fa-sync"></i>
                            Restart Core
                        </button>
                    </div>
                </div>

                <!-- AI Agents -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-robot"></i>
                            AI Agents
                        </div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <span class="stat-label">Active Agents:</span>
                            <span class="stat-value">${agentsData.active}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Queue Length:</span>
                            <span class="stat-value">${agentsData.queue}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Success Rate:</span>
                            <span class="stat-value" style="color: #10b981;">${agentsData.successRate}%</span>
                        </div>
                    </div>
                    <div style="margin-top: 16px; display: flex; gap: 8px;">
                        <button class="btn btn-primary" onclick="manageAgents()">
                            <i class="fas fa-cog"></i>
                            Manage
                        </button>
                        <button class="btn btn-success" onclick="deployNewAgent()">
                            <i class="fas fa-plus"></i>
                            Deploy New
                        </button>
                    </div>
                </div>

                <!-- Development Environment -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-laptop-code"></i>
                            Development Environment
                        </div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <span class="stat-label">SkIDEancer:</span>
                            <span class="stat-value" style="color: ${serviceStatus.skideancer ? '#10b981' : '#f59e0b'};">
                                ${serviceStatus.skideancer ? 'Running' : 'Starting...'}
                            </span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Browser Hub:</span>
                            <span class="stat-value" style="color: #10b981;">Active</span>
                        </div>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="btn btn-primary" onclick="openService('skideancer')">
                            <i class="fas fa-external-link-alt"></i>
                            Open IDE
                        </button>
                    </div>
                </div>

                <!-- System Resources -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <i class="fas fa-server"></i>
                            System Resources
                        </div>
                    </div>
                    <div class="card-stats">
                        <div class="stat-item">
                            <span class="stat-label">CPU Usage:</span>
                            <span class="stat-value">${systemData.cpu}%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Memory:</span>
                            <span class="stat-value">${systemData.memory.used}GB / ${systemData.memory.total}GB</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Disk:</span>
                            <span class="stat-value">${systemData.disk.used}GB / ${systemData.disk.total}GB</span>
                        </div>
                    </div>
                    <div style="margin-top: 16px;">
                        <button class="btn btn-secondary" onclick="viewMetrics()">
                            <i class="fas fa-chart-line"></i>
                            View Metrics
                        </button>
                    </div>
                </div>
            `;
        }

        function generateStaticDashboardCards() {
            return generateDashboardCards(
                { active: 12, total: 15, queue: 3, successRate: 97.5 },
                { cpu: 45, memory: { used: 2.1, total: 8 }, disk: { used: 156, total: 500 } }
            );
        }

        // UI Helper Functions
        function updateAddressBar() {
            const tab = tabs.get(activeTabId);
            const addressInput = document.getElementById('addressInput');
            if (tab && addressInput) {
                addressInput.value = tab.url;
            }
        }

        function updateNavigationButtons() {
            const tab = tabs.get(activeTabId);
            const backBtn = document.getElementById('backBtn');
            const forwardBtn = document.getElementById('forwardBtn');
            
            if (tab && backBtn && forwardBtn) {
                backBtn.disabled = tab.historyIndex <= 0;
                forwardBtn.disabled = tab.historyIndex >= tab.history.length - 1;
            }
        }

        function updateTabTitle(tabId, title) {
            const tab = tabs.get(tabId);
            const tabElement = document.querySelector(`[data-tab-id="${tabId}"] .tab-title`);
            
            if (tab && tabElement) {
                tab.title = title;
                tabElement.textContent = title.length > 20 ? title.substring(0, 20) + '...' : title;
            }
        }

        function updateTabCount() {
            const tabCountElement = document.getElementById('tabCount');
            if (tabCountElement) {
                const count = tabs.size;
                tabCountElement.textContent = `${count} tab${count !== 1 ? 's' : ''}`;
            }
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }

        // Section Management
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const arrow = document.getElementById(sectionId + '-arrow');
            
            if (section && arrow) {
                section.classList.toggle('collapsed');
                arrow.classList.toggle('collapsed');
            }
        }

        // Action Handlers
        function restartCore() {
            // Try to restart services via IPC if available
            if (window.electronAPI) {
                window.electronAPI.invoke('native:execute', 'restart_services', [])
                    .then(() => {
                        console.log('Services restart initiated');
                        setTimeout(checkServiceStatus, 2000);
                    })
                    .catch(err => console.log('Service restart failed:', err));
            }
        }

        function manageAgents() {
            openService('agents');
        }

        function deployNewAgent() {
            openService('agents');
        }

        function viewMetrics() {
            openService('analytics');
        }

        // Zoom functionality
        let currentZoom = 1;

        function adjustZoom(delta) {
            currentZoom = Math.max(0.5, Math.min(2, currentZoom + delta));
            document.documentElement.style.setProperty('--zoom-level', currentZoom);
        }

        function resetZoom() {
            currentZoom = 1;
            document.documentElement.style.setProperty('--zoom-level', currentZoom);
        }

        // Service status notification
        function showServiceStatusNotification() {
            const onlineServices = Object.values(serviceStatus).filter(status => status === true).length;
            const totalServices = Object.keys(serviceStatus).length;
            
            let message, type;
            
            if (onlineServices === 0) {
                message = '‚ö†Ô∏è All services offline - Limited functionality available';
                type = 'warning';
            } else if (onlineServices < totalServices) {
                message = `‚úÖ ${onlineServices}/${totalServices} services online - Partial functionality`;
                type = 'info';
            } else {
                message = 'üéâ All services online - Full functionality available!';
                type = 'success';
            }
            
            showTemporaryNotification(message, type);
        }

        function showTemporaryNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'warning' ? '#f59e0b' : '#4f46e5'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 350px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            `;
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideIn 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '=':
                    case '+':
                        e.preventDefault();
                        adjustZoom(0.1);
                        break;
                    case '-':
                        e.preventDefault();
                        adjustZoom(-0.1);
                        break;
                    case '0':
                        e.preventDefault();
                        resetZoom();
                        break;
                    case 't':
                        e.preventDefault();
                        createNewTab();
                        break;
                    case 'w':
                        if (tabs.size > 1) {
                            e.preventDefault();
                            closeTab(activeTabId);
                        }
                        break;
                }
            }
        });

        // Update navigation item status based on service health
        function updateNavItemStatus() {
            const serviceMapping = {
                'skideancer': 'skideancer',
                'agents': 'gateway',
                'workflows': 'frontend',
                'analytics': 'frontend'
            };
            
            // Update status dots for nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                const onclick = item.getAttribute('onclick');
                if (onclick && onclick.includes('openService')) {
                    const serviceName = onclick.match(/openService\('([^']+)'\)/)?.[1];
                    const statusDot = item.querySelector('.status-dot');
                    
                    if (statusDot && serviceName && serviceMapping[serviceName]) {
                        const isOnline = serviceStatus[serviceMapping[serviceName]];
                        statusDot.className = `status-dot ${isOnline ? 'online' : 'offline'}`;
                    }
                }
            });
        }

        // Initialize sections on load
        function initializeSections() {
            // Set default collapsed states
            const sectionsToCollapse = ['auto-section'];
            
            sectionsToCollapse.forEach(sectionId => {
                const section = document.getElementById(sectionId);
                const arrow = document.getElementById(sectionId + '-arrow');
                if (section && arrow) {
                    section.classList.add('collapsed');
                    arrow.classList.add('collapsed');
                }
            });
        }

        // Terminal Management
        let terminalVisible = false;
        let terminalSize = 'normal'; // 'normal', 'large'
        let terminalProcess = null;

        function toggleTerminal() {
            const terminalSection = document.getElementById('terminalSection');
            
            if (!terminalVisible) {
                showTerminal();
            } else {
                hideTerminal();
            }
        }

        function showTerminal() {
            const terminalSection = document.getElementById('terminalSection');
            const terminalContent = document.getElementById('terminalContent');
            
            terminalSection.classList.add('visible');
            terminalVisible = true;
            
            // Check if running in electron or browser mode
            if (window.electronAPI) {
                // Electron mode - try to get terminal output from the dev server
                loadTerminalFromDevServer();
            } else {
                // Browser mode - show fallback
                showTerminalFallback();
            }
        }

        function hideTerminal() {
            const terminalSection = document.getElementById('terminalSection');
            terminalSection.classList.remove('visible');
            terminalVisible = false;
        }

        function loadTerminalFromDevServer() {
            const terminalContent = document.getElementById('terminalContent');
            
            // Try to create an iframe pointing to a simple terminal output page
            // This would need to be created as a separate service
            const iframe = document.createElement('iframe');
            iframe.className = 'terminal-iframe';
            iframe.src = 'http://localhost:3001/terminal'; // Terminal output service
            
            iframe.onerror = () => {
                showTerminalFallback();
            };
            
            iframe.onload = () => {
                console.log('Terminal loaded successfully');
            };
            
            terminalContent.innerHTML = '';
            terminalContent.appendChild(iframe);
            
            // Fallback after timeout
            setTimeout(() => {
                if (iframe.contentDocument === null) {
                    showTerminalFallback();
                }
            }, 5000);
        }

        function showTerminalFallback() {
            const terminalContent = document.getElementById('terminalContent');
            
            terminalContent.innerHTML = `
                <div class="terminal-fallback">
                    <i class="fas fa-exclamation-triangle" style="font-size: 32px; color: #f59e0b; margin-bottom: 12px;"></i>
                    <h3 style="color: #ffffff; margin-bottom: 8px;">Terminal Not Available</h3>
                    <p style="margin-bottom: 8px;">Terminal output is not available in browser mode.</p>
                    <p style="font-size: 12px; margin-bottom: 16px;">Use the Electron app to access terminal features.</p>
                    <div style="display: flex; gap: 8px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="openService('skideancer')">
                            <i class="fas fa-external-link-alt"></i> Open SkIDEancer Terminal
                        </button>
                        <button class="btn btn-secondary" onclick="hideTerminal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                    </div>
                </div>
            `;
        }

        function clearTerminal() {
            if (window.electronAPI) {
                // Try to clear terminal via electron API
                window.electronAPI.nativeExecute('clear_terminal', [])
                    .catch(() => {
                        console.log('Failed to clear terminal');
                    });
            }
        }

        function toggleTerminalSize() {
            const terminalSection = document.getElementById('terminalSection');
            
            if (terminalSize === 'normal') {
                terminalSection.style.height = '350px';
                terminalSize = 'large';
            } else {
                terminalSection.style.height = '200px';
                terminalSize = 'normal';
            }
        }

        // Prompt Management
        let promptTemplates = [];
        let promptFolders = JSON.parse(localStorage.getItem('promptFolders') || '[]');
        let promptManagerVisible = false;

        function openPromptManager() {
            const promptManager = document.getElementById('promptManager');
            promptManager.classList.add('visible');
            promptManagerVisible = true;
            
            loadPromptTemplates();
        }

        function closePromptManager() {
            const promptManager = document.getElementById('promptManager');
            promptManager.classList.remove('visible');
            promptManagerVisible = false;
        }

        async function loadPromptTemplates() {
            const promptManagerBody = document.getElementById('promptManagerBody');
            
            // Show loading state
            promptManagerBody.innerHTML = '<div style="text-align: center; padding: 20px;"><div class="loading-spinner"></div><p style="margin-top: 12px;">Loading templates...</p></div>';
            
            try {
                // Try to load from API if available
                if (window.electronAPI) {
                    const response = await window.electronAPI.nativeExecute('get_prompt_templates', []);
                    if (response.success) {
                        promptTemplates = JSON.parse(response.output);
                    } else {
                        throw new Error('Failed to load templates');
                    }
                } else {
                    throw new Error('Not in electron mode');
                }
            } catch (error) {
                // Use default templates
                promptTemplates = getDefaultPromptTemplates();
            }
            
            renderPromptTemplates();
        }

        function getDefaultPromptTemplates() {
            return [
                {
                    id: 'agent_task',
                    name: 'Agent Task Assignment',
                    description: 'Template for assigning tasks to AI agents',
                    category: 'agent',
                    tags: ['task', 'assignment', 'agent'],
                    template: 'You are an AI agent with the following capabilities: {{capabilities}}. Please complete this task: {{task}}. Context: {{context}}'
                },
                {
                    id: 'code_review',
                    name: 'Code Review Request',
                    description: 'Template for requesting code reviews',
                    category: 'development',
                    tags: ['code', 'review', 'development'],
                    template: 'Please review the following {{language}} code and provide feedback on:\n1. Code quality\n2. Best practices\n3. Potential issues\n4. Suggestions for improvement\n\nCode:\n```{{language}}\n{{code}}\n```'
                },
                {
                    id: 'error_analysis',
                    name: 'Error Analysis',
                    description: 'Template for analyzing errors and bugs',
                    category: 'debugging',
                    tags: ['error', 'analysis', 'debugging'],
                    template: 'Analyze the following error and provide:\n1. Root cause analysis\n2. Potential solutions\n3. Prevention strategies\n\nError: {{error}}\nContext: {{context}}\nStack trace: {{stackTrace}}'
                }
            ];
        }

        function renderPromptTemplates() {
            const promptManagerBody = document.getElementById('promptManagerBody');
            
            if (promptTemplates.length === 0) {
                promptManagerBody.innerHTML = '<div style="text-align: center; padding: 20px; color: #9ca3af;">No prompt templates available</div>';
                return;
            }
            
            const templatesHTML = promptTemplates.map(template => `
                <div class="prompt-template" onclick="selectPromptTemplate('${template.id}')">
                    <div class="prompt-template-name">${template.name}</div>
                    <div class="prompt-template-description">${template.description}</div>
                    <div class="prompt-template-tags">
                        ${template.tags.map(tag => `<span class="prompt-tag">${tag}</span>`).join('')}
                    </div>
                </div>
            `).join('');
            
            promptManagerBody.innerHTML = templatesHTML;
        }

        function selectPromptTemplate(templateId) {
            const template = promptTemplates.find(t => t.id === templateId);
            if (template) {
                // Copy template to clipboard
                navigator.clipboard.writeText(template.template).then(() => {
                    showTemporaryNotification(`‚úÖ Template "${template.name}" copied to clipboard!`, 'success');
                    closePromptManager();
                }).catch(() => {
                    showTemporaryNotification('Failed to copy template', 'error');
                });
            }
        }

        // Custom Menu Items Management
        let customMenuItems = JSON.parse(localStorage.getItem('customMenuItems') || '[]');

        function addCustomMenuItem() {
            const name = prompt('Enter a name for the custom link:');
            if (!name) return;
            
            const url = prompt('Enter the URL:');
            if (!url) return;
            
            const icon = prompt('Enter a FontAwesome icon class (e.g., "fas fa-star"):') || 'fas fa-link';
            
            const menuItem = {
                id: Date.now().toString(),
                name: name,
                url: url,
                icon: icon
            };
            
            customMenuItems.push(menuItem);
            localStorage.setItem('customMenuItems', JSON.stringify(customMenuItems));
            
            renderCustomMenuItems();
            showTemporaryNotification(`‚úÖ Added custom link: ${name}`, 'success');
        }

        function removeCustomMenuItem(itemId) {
            customMenuItems = customMenuItems.filter(item => item.id !== itemId);
            localStorage.setItem('customMenuItems', JSON.stringify(customMenuItems));
            renderCustomMenuItems();
            showTemporaryNotification('Custom link removed', 'info');
        }

        function renderCustomMenuItems() {
            const customSection = document.getElementById('custom-section');
            const addButton = customSection.querySelector('.add-menu-item');
            
            // Remove existing custom items
            customSection.querySelectorAll('.nav-item').forEach(item => item.remove());
            
            // Add custom menu items
            customMenuItems.forEach(item => {
                const navItem = document.createElement('div');
                navItem.className = 'nav-item';
                navItem.innerHTML = `
                    <i class="${item.icon}"></i>
                    <span>${item.name}</span>
                    <button class="terminal-btn" onclick="event.stopPropagation(); removeCustomMenuItem('${item.id}')" style="margin-left: auto; padding: 2px 4px;">
                        <i class="fas fa-times" style="font-size: 10px;"></i>
                    </button>
                `;
                
                navItem.onclick = (e) => {
                    if (e.target.closest('.terminal-btn')) return;
                    createNewTab(item.url, item.name);
                };
                
                customSection.insertBefore(navItem, addButton);
            });
        }

        // Enhanced Prompt Management Functions
        let promptFolders = JSON.parse(localStorage.getItem('promptFolders') || '[]');
        
        function showNewPromptForm() {
            document.getElementById('newPromptModal').style.display = 'block';
        }
        
        function closeNewPromptModal() {
            document.getElementById('newPromptModal').style.display = 'none';
            // Clear form
            document.getElementById('newPromptForm').reset();
        }
        
        function showNewFolderForm() {
            const folderName = prompt('Enter folder name:');
            if (!folderName) return;
            
            const folder = {
                id: Date.now().toString(),
                name: folderName,
                prompts: []
            };
            
            promptFolders.push(folder);
            localStorage.setItem('promptFolders', JSON.stringify(promptFolders));
            showTemporaryNotification(`‚úÖ Created folder: ${folderName}`, 'success');
        }
        
        function saveNewPrompt() {
            const form = document.getElementById('newPromptForm');
            const formData = new FormData(form);
            
            const prompt = {
                id: Date.now().toString(),
                name: formData.get('name'),
                description: formData.get('description'),
                category: formData.get('category'),
                template: formData.get('template'),
                tags: formData.get('tags').split(',').map(tag => tag.trim()).filter(tag => tag),
                createdAt: new Date().toISOString()
            };
            
            // Save to electron backend if available
            if (window.electronAPI) {
                window.electronAPI.createPromptTemplate(prompt).then(() => {
                    showTemporaryNotification(`‚úÖ Created prompt: ${prompt.name}`, 'success');
                    loadPromptTemplates(); // Reload templates
                }).catch(error => {
                    console.error('Failed to save prompt:', error);
                    // Fall back to local storage
                    promptTemplates.push(prompt);
                    renderPromptTemplates();
                    showTemporaryNotification(`‚úÖ Created prompt locally: ${prompt.name}`, 'success');
                });
            } else {
                // Browser mode - save to local templates
                promptTemplates.push(prompt);
                renderPromptTemplates();
                showTemporaryNotification(`‚úÖ Created prompt: ${prompt.name}`, 'success');
            }
            
            closeNewPromptModal();
        }
        
        // Account, Settings, and Sign In Functions
        function openAccount() {
            showTemporaryNotification('Opening Account settings...', 'info');
            // In a real implementation, this would open account management
            createNewTab('http://localhost:3000/account', 'Account');
        }
        
        function openSettings() {
            showTemporaryNotification('Opening Settings...', 'info');
            // In a real implementation, this would open settings panel
            createNewTab('http://localhost:3000/settings', 'Settings');
        }
        
        function openSignIn() {
            showTemporaryNotification('Opening Sign In...', 'info');
            // In a real implementation, this would open sign in modal
            createNewTab('http://localhost:3000/auth/signin', 'Sign In');
        }
        
        // Fix Dashboard Tab Clickability
        function switchToTab(tabName) {
            // Fix the dashboard tab click issue
            if (tabName === 'dashboard') {
                createNewTab('http://localhost:3000', 'TNF Dashboard');
                return;
            }
            
            // Handle other tabs
            const tabMap = {
                'agents': 'http://localhost:3000/agents',
                'workflows': 'http://localhost:3000/workflows', 
                'analytics': 'http://localhost:3000/analytics'
            };
            
            if (tabMap[tabName]) {
                createNewTab(tabMap[tabName], getServiceTitle(tabName));
            }
        }
        
        // Enhanced Drag and Drop for Prompts (basic implementation)
        function enablePromptDragDrop() {
            const promptTemplates = document.querySelectorAll('.prompt-template');
            
            promptTemplates.forEach(template => {
                template.draggable = true;
                template.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', template.dataset.id || '');
                    template.style.opacity = '0.5';
                });
                
                template.addEventListener('dragend', (e) => {
                    template.style.opacity = '1';
                });
            });
            
            // Add drop zones for folders (simplified implementation)
            const promptManager = document.getElementById('promptManagerBody');
            
            promptManager.addEventListener('dragover', (e) => {
                e.preventDefault();
            });
            
            promptManager.addEventListener('drop', (e) => {
                e.preventDefault();
                const promptId = e.dataTransfer.getData('text/plain');
                // In a full implementation, this would move the prompt to a folder
                showTemporaryNotification('Drag and drop organization coming soon!', 'info');
            });
        }
        
        // Initialize enhanced features
        function initializeEnhancedFeatures() {
            // Initialize drag and drop
            setTimeout(() => {
                enablePromptDragDrop();
            }, 1000);
            
            // Fix dashboard tab - make sure it's clickable
            const dashboardItems = document.querySelectorAll('[onclick*="dashboard"]');
            dashboardItems.forEach(item => {
                item.style.cursor = 'pointer';
                item.style.pointerEvents = 'auto';
            });
            
            // Load any saved prompt folders
            if (promptFolders.length > 0) {
                console.log('Loaded prompt folders:', promptFolders);
            }
        }

        // Initialize custom menu items on load
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing initialization ...
            renderCustomMenuItems();
            initializeEnhancedFeatures();
        });
    </script>
</body>
</html>